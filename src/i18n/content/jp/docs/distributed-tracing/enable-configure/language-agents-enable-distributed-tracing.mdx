---
title: 言語エージェントと分散トレース
tags:
  - Understand dependencies
  - Distributed tracing
  - Enable and configure
metaDescription: How to enable distributed tracing or Infinite Tracing for APM agents.
translationType: machine
---

import clogo from 'images/clogo.png'

import gologo from 'images/gologo.png'

import javalogo from 'images/javalogo.png'

import dotnetlogo from 'images/dotnetlogo.png'

import nodejslogo from 'images/nodejslogo.png'

import pythonlogo from 'images/pythonlogo.png'

import phplogo from 'images/phplogo.png'

import rubylogo from 'images/rubylogo.png'

C、Go、Java、Node.js、.NET、PHP、Python、またはRuby用のNew Relic APMエージェントの新しいインスタンスをインストールすると、標準の分散トレースがデフォルトでオンになります。

APMエージェントのこのデフォルトの分散トレースは、ヘッドベースのサンプリングを使用します。これは、トレースがNew Relicに到着する前に、アルゴリズムを適用して、受け入れて分析するトレースの数を決定することを意味します。このデフォルトのヘッドベースのサンプリングにより、分散システムで何が起こっているかについての基本的な洞察を得ることができます。

また、Infinite Tracingも提供しています。これは、分散システムの可視性をさらに高めることができるため、お勧めします。このオプションでは、テールベースのサンプリングを使用します。つまり、トレースを100％収集して分析するまで、サンプリングは行われません。トレースはクラウドベースのトレースオブザーバーに送信され、データを収集して分析し、役立つトレースを探します。

新しいエージェントをインストールして分散トレースを取得する場合でも、古いエージェントで分散トレースをオンにするためのサポートが必要な場合でも、次の手順を実行できます。

* [新しいエージェントのトレースを設定する：](#new-agentsl)ヘッドベースおよびテールベースのサンプリングの手順
* [古いAPMエージェント：古いAPMエージェント](#older-agents)がある場合のトレースオプション
* [手動インストルメンテーション：](#manual-instrumentation)自動インストルメンテーションが機能しない場合のヒント

<Callout variant="tip">
  始める前に背景を詳しく知りたい場合は、次のトピックを確認してください。

  * [スパンサンプリングのしくみ](/docs/understand-dependencies/distributed-tracing/get-started/how-new-relic-distributed-tracing-works#sampling)は、分散トレースオプションを説明しています。
  * [APMへの影響](/docs/apm/distributed-tracing/getting-started/transition-guide-distributed-tracing)は、現在のAPMユーザーであるが、分散トレースを設定していない場合に何を期待できるかを示します。
</Callout>

## 新しいエージェントのトレースを設定する [#new-agents]

標準の分散トレース（ヘッドベースのサンプリング）を試すだけの場合でも、無限トレース（テールベースのサンプリング）を設定する場合でも、標準の分散トレースを設定することから始める必要があります。ヘッドベースのサンプリングを実行するために、APMエージェントのインストールについて説明します。次に、無限トレースを試してみたい場合は、いくつかの追加手順を実行できます。

### エージェントをインストールして、標準の分散トレースを取得します。 [#quick-start-apm]

これは、サービスにAPMエージェントをまだインストールしていない場合、または追加のサービスをインストルメント化する場合に、[標準の分散トレース](/docs/distributed-tracing/concepts/how-new-relic-distributed-tracing-works/#head-based)を設定するための最良のアプローチです。

<Callout variant="tip">
  分散トレースを設定するには、NewRelicアカウントが必要です。まだ持っていない場合は、すぐにできます  
  [無料のアカウントを作成します](https://newrelic.com/signup)。
</Callout>

#### ステップ1.サービスを特定する

インストルメントするサービスを見つけて、それぞれがトレースデータをNewRelicに送信するようにします。識別したサービスごとに、次の手順のヒントに従ってAPMエージェントをインストールします。

#### ステップ2.各サービスをAPMエージェントでインストルメント化する [#update-agents]

新しいAPMエージェントをインストールして、デフォルトの分散トレースを取得します。各サービスのインストルメンテーションを支援するために、さまざまな言語のインストールアシスタントがあります。

インストルメントするサービスごとにインストールアシスタントを実行して、各インストールに一意のアプリケーション名が付いていることを確認する必要があります。

アシスタントを開始するには、お使いの言語のリンクをクリックしてください。

<TechTileGrid>
  <TechTile
    name="APM: C"
    to="https://one.newrelic.com/launcher/nr1-core.settings?pane=eyJuZXJkbGV0SWQiOiJ0dWNzb24ucGxnLWluc3RydW1lbnQtZXZlcnl0aGluZyJ9&cards[0]=eyJuZXJkbGV0SWQiOiJzZXR1cC1uZXJkbGV0cy5zZXR1cC1jLWludGVncmF0aW9uIiwiYWNjb3VudElkIjoyNjQwNDA5fQ==&platform[accountId]=2498654&platform[timeRange][duration]=1800000&platform[$isFallbackTimeRange]=true"
    icon={<img variant="TechTile" src={clogo} alt="C"/>}
  />

  <TechTile
    name="APM: Golang"
    to="https://one.newrelic.com/launcher/nr1-core.settings?pane=eyJuZXJkbGV0SWQiOiJ0dWNzb24ucGxnLWluc3RydW1lbnQtZXZlcnl0aGluZyJ9&cards[0]=eyJuZXJkbGV0SWQiOiJzZXR1cC1uZXJkbGV0cy5zZXR1cC1nby1pbnRlZ3JhdGlvbiIsImFjY291bnRJZCI6MjY0MDQwOX0=&platform[accountId]=2498654&platform[timeRange][duration]=1800000&platform[$isFallbackTimeRange]=true"
    icon={<img variant="TechTile" src={gologo} alt="Golang"/>}
  />

  <TechTile
    name="APM: Java"
    to="https://one.newrelic.com/launcher/nr1-core.settings?pane=eyJuZXJkbGV0SWQiOiJ0dWNzb24ucGxnLWluc3RydW1lbnQtZXZlcnl0aGluZyJ9&cards[0]=eyJuZXJkbGV0SWQiOiJzZXR1cC1uZXJkbGV0cy5zZXR1cC1qYXZhLWludGVncmF0aW9uIiwiYWNjb3VudElkIjoyNjQwNDA5fQ==&platform[accountId]=2498654&platform[timeRange][duration]=1800000&platform[$isFallbackTimeRange]=true"
    icon={<img variant="TechTile" src={javalogo} alt="Java"/>}
  />

  <TechTile
    name="APM: .NET"
    to="https://one.newrelic.com/launcher/nr1-core.settings?pane=eyJuZXJkbGV0SWQiOiJ0dWNzb24ucGxnLWluc3RydW1lbnQtZXZlcnl0aGluZyJ9&cards[0]=eyJuZXJkbGV0SWQiOiJzZXR1cC1uZXJkbGV0cy5zZXR1cC1kb3RuZXQtaW50ZWdyYXRpb24iLCJhY2NvdW50SWQiOjI2NDA0MDl9&platform[accountId]=2498654&platform[timeRange][duration]=1800000&platform[$isFallbackTimeRange]=true"
    icon={<img variant="TechTile" src={dotnetlogo} alt=".NET"/>}
  />

  <TechTile
    name="APM: Node.js"
    to="https://one.newrelic.com/launcher/nr1-core.settings?pane=eyJuZXJkbGV0SWQiOiJ0dWNzb24ucGxnLWluc3RydW1lbnQtZXZlcnl0aGluZyJ9&cards[0]=eyJuZXJkbGV0SWQiOiJzZXR1cC1uZXJkbGV0cy5zZXR1cC1ub2RlLWludGVncmF0aW9uIiwiYWNjb3VudElkIjoyNjQwNDA5fQ==&platform[accountId]=2498654&platform[timeRange][duration]=1800000&platform[$isFallbackTimeRange]=true"
    icon={<img variant="TechTile" src={nodejslogo} alt="Node.js"/>}
  />

  <TechTile
    name="APM: PHP"
    to="https://one.newrelic.com/launcher/nr1-core.settings?pane=eyJuZXJkbGV0SWQiOiJ0dWNzb24ucGxnLWluc3RydW1lbnQtZXZlcnl0aGluZyJ9&cards[0]=eyJuZXJkbGV0SWQiOiJzZXR1cC1uZXJkbGV0cy5zZXR1cC1waHAtaW50ZWdyYXRpb24iLCJhY2NvdW50SWQiOjI2NDA0MDl9&platform[accountId]=2498654&platform[timeRange][duration]=1800000&platform[$isFallbackTimeRange]=true"
    icon={<img variant="TechTile" src={phplogo} alt="PHP"/>}
  />

  <TechTile
    name="APM: Python"
    to="https://one.newrelic.com/launcher/nr1-core.settings?pane=eyJuZXJkbGV0SWQiOiJ0dWNzb24ucGxnLWluc3RydW1lbnQtZXZlcnl0aGluZyJ9&cards[0]=eyJuZXJkbGV0SWQiOiJzZXR1cC1uZXJkbGV0cy5zZXR1cC1weXRob24taW50ZWdyYXRpb24iLCJhY2NvdW50SWQiOjI2NDA0MDl9&platform[accountId]=2498654&platform[timeRange][duration]=1800000&platform[$isFallbackTimeRange]=true"
    icon={<img variant="TechTile" src={pythonlogo} alt="Python"/>}
  />

  <TechTile
    name="APM: Ruby"
    to="https://one.newrelic.com/launcher/nr1-core.settings?pane=eyJuZXJkbGV0SWQiOiJ0dWNzb24ucGxnLWluc3RydW1lbnQtZXZlcnl0aGluZyJ9&cards[0]=eyJuZXJkbGV0SWQiOiJzZXR1cC1uZXJkbGV0cy5zZXR1cC1ydWJ5LWludGVncmF0aW9uIiwiYWNjb3VudElkIjoyNjQwNDA5fQ==&platform[accountId]=2498654&platform[timeRange][duration]=1800000&platform[$isFallbackTimeRange]=true"
    icon={<img variant="TechTile" src={rubylogo} alt="Ruby"/>}
  />
</TechTileGrid>

<Callout variant="tip">
  インストールアシスタントを使用したこのクイックスタートアプローチでは、実行するサービスごとに分散トレースが自動的に有効になりますが、分散トレースに参加するAPMエージェントが既にある場合は、分散トレースを手動で有効にする必要があります。[古いAPMエージェントのオプションを](#older-agents)参照してください。
</Callout>

#### ステップ3.トレースを表示する [#view-traces]

各サービスをAPMエージェントでインストルメント化した後、アプリケーションでトラフィックを生成して、トレースをキャプチャできるようにします。UIでトレースを表示する2つの方法は次のとおりです。

<CollapserGroup>
  <Collapser
    id="entity-explorer"
    title="特定のサービスを含むトレースを表示する"
  >
    特定のサービスのトレースを確認する1つの方法は次のとおりです。

    1. **[one.newrelic.com](https://one.newrelic.com/)**にアクセスします。
    2. 上部のメニューバーで\[ **APM** ]をクリックします。
    3. サービスをクリックします。
    4. 左側のナビゲーションの\[**監視**]セクションで、\[**分散トレース**]をクリックします。
    5. 必要なトレースが表示されない場合は、 `trace.id`でフィルタリングできます。
  </Collapser>

  <Collapser
    id="dt-launcher"
    title="アカウント全体のトレースを表示する"
  >
    このオプションを使用すると、アクセスできる組織内のすべてのNewRelicアカウントのすべてのトレースを検索できます。

    1. **[one.newrelic.com](https://one.newrelic.com/)**にアクセスします。
    2. 上部のメニューバーで\[**データの参照**]をクリックし、\[**トレース**]をクリックします。
    3. 左側のペインでエンティティを選択します。
    4. 必要なトレースが表示されない場合は、 `trace.id`でフィルタリングできます。
  </Collapser>

  <Collapser
    id="logs-context"
    title="トレースの詳細についてログを調べます"
  >
    ログとアプリケーションのデータをまとめて、トラブルシューティングをより簡単かつ迅速に行うことができます。[コンテキスト内](/docs/logs/logs-context/configure-logs-context-apm-agents/)のログを使用すると、エラーとトレースに関連するログメッセージをアプリのUIで直接確認できます。

    1. \[**トランザクション**]ページで、トレースをクリックして\[ [**トレースの詳細**\]ページ](/docs/apm/transactions/transaction-traces/transaction-traces-trace-details-page)に移動します。
    2. トレースの詳細ページで、\[**ログを**表示]をクリックします。
    3. 個々のログメッセージに関連する詳細を表示するには、メッセージを直接クリックします。
  </Collapser>
</CollapserGroup>

UIでトレースを見つけるための詳細については、以下を参照してください。

* [分散トレースUIを理解して使用する](/docs/distributed-tracing/ui-data/understand-use-distributed-tracing-ui)
* [分散トレースデータのクエリ](/docs/understand-dependencies/distributed-tracing/ui-data/query-distributed-trace-data)

### 無限トレースの設定（推奨） [#infinite-tracing]

APMエージェントの標準分散トレース（上記）は、 [適応サンプリング](/docs/distributed-tracing/concepts/how-new-relic-distributed-tracing-works/#trace-origin-sampling)を使用して1分あたり最大10トレースをキャプチャしますが、すべてのデータを分析して最も関連性の高いトレースを見つけたい場合は、無限トレースを設定できます。標準の分散トレースのこの代替手段は、CSDKを除くすべてのAPM言語エージェントで使用できます。

<Callout variant="tip">
  この機能の詳細については、「 [無限トレース](/docs/understand-dependencies/distributed-tracing/infinite-tracing/introduction-infinite-tracing)」を参照してください。
</Callout>

開始する前に、まず[要件を満たしている](/docs/understand-dependencies/distributed-tracing/infinite-tracing/introduction-infinite-tracing#requirements)ことを確認してください。

#### 手順1.標準の分散トレースのインストルメンテーションを完了します

Infinite Tracingのセットアップは、[標準の分散トレース](#quick-start-apm)の上記のインストルメンテーション手順に基づいています。トレースオブザーバーに関する次のステップに進む前に、これらを完了していることを確認してください。

#### ステップ2.トレースオブザーバーを設定します [#provision-trace-observer]

トレースオブザーバーは、すべてのトレースを収集して分析するNewRelicAWSベースのサービスです。[トレースオブザーバーの設定](/docs/understand-dependencies/distributed-tracing/infinite-tracing/set-trace-observer)の手順に従います。完了したら、トレースオブザーバー情報をここに戻し、次の手順に進んでエージェントを構成します。

#### 手順3：エージェントを無限トレース用に構成する

無限トレース構成設定には、標準の分散トレースに加えて、トレースオブザーバーに関する情報が含まれます。言語エージェントの設定を以下で見つけます。

<CollapserGroup>
  <Collapser
    id="c-sdk-config"
    title="CSDK"
  >
    CSDKでは無限トレースは使用できません。
  </Collapser>

  <Collapser
    id="go-config"
    title="Go"
  >
    設定の概要は次のとおりです。構成の詳細については[、「Goアプリケーションの分散トレースを有効にする」を参照してください](/docs/agents/go-agent/features/enable-distributed-tracing-go-agent)。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            タイプ
          </th>

          <th>
            必要な構成
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            無限のトレース
          </td>

          <td>
            構成オプション：

            * `newrelic.Config` 構造：

              ```
              app, err := newrelic.NewApplication(
                  newrelic.ConfigAppName(<var>YOUR_APP_NAME</var>),
                  newrelic.ConfigLicense(<var>YOUR_LICENSE_KEY</var>),
                  func(cfg *newrelic.Config) {
                      cfg.DistributedTracer.Enabled = true
                      cfg.InfiniteTracing.TraceObserver.Host = <var>YOUR_TRACE_OBSERVER_HOST</var>
                  },
              )
              ```

            * 環境変数：

              ```
              NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true
              NEW_RELIC_INFINITE_TRACING_TRACE_OBSERVER_HOST=<a href="/docs/understand-dependencies/distributed-tracing/infinite-tracing/set-trace-observer#ui-endpoints"><var>YOUR_TRACE_OBSERVER_HOST</var></a>
              ```
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="java-config"
    title="Java"
  >
    設定の概要は次のとおりです。構成の詳細については、「 [Javaエージェントの構成：構成ファイル](/docs/agents/java-agent/configuration/java-agent-configuration-config-file)」を参照してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            タイプ
          </th>

          <th>
            必要な構成
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            無限のトレース
          </td>

          <td>
            構成オプション：

            * 構成ファイル（ `newrelic.yml` ）（ `common`スタンザの下に2つのスペースをインデント）：

              ```
              distributed_tracing:
                enabled: true
              infinite_tracing:
                trace_observer:
                  host: <a href="/docs/understand-dependencies/distributed-tracing/infinite-tracing/set-trace-observer#ui-endpoints"><var>"YOUR_TRACE_OBSERVER_HOST"</var></a>                   
              ```

            * Javaシステムプロパティ：

              ```
              -Dnewrelic.config.distributed_tracing.enabled=true
              -Dnewrelic.config.infinite_tracing.trace_observer.host=<var>"YOUR_TRACE_OBSERVER_HOST"</var>
              ```

            * 環境変数：

              ```
              NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true
              NEW_RELIC_INFINITE_TRACING_TRACE_OBSERVER_HOST=<a href="/docs/understand-dependencies/distributed-tracing/infinite-tracing/set-trace-observer#ui-endpoints"><var>"YOUR_TRACE_OBSERVER_HOST"</var></a>
              ```
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="dot-net-config"
    title=".NET"
  >
    設定の概要は次のとおりです。構成の詳細については、 [.NETエージェントの構成](/docs/agents/net-agent/configuration/net-agent-configuration#distributed_tracing)を参照してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            タイプ
          </th>

          <th>
            必要な構成
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            無限のトレース
          </td>

          <td>
            構成オプション：

            * 構成ファイル（ `newrelic.config` ）：

              ```
              <configuration . . . >
                 <distributedTracing enabled="true" />
                 <infiniteTracing>
                    <trace_observer host="<a href='/docs/understand-dependencies/distributed-tracing/infinite-tracing/set-trace-observer#ui-endpoints'><var>YOUR_TRACE_OBSERVER_HOST</var></a>" />
                 </infiniteTracing>
              </configuration>
              ```

            * 環境変数：

              ```
              NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true
              NEW_RELIC_INFINITE_TRACING_TRACE_OBSERVER_HOST="<a href="/docs/understand-dependencies/distributed-tracing/infinite-tracing/set-trace-observer#ui-endpoints"><var>YOUR_TRACE_OBSERVER_HOST</var></a>"
              ```
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="node-config"
    title="Node.js"
  >
    設定の概要は次のとおりです。構成の詳細については、 [Node.jsエージェントの構成](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#distributed-tracing)を参照してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            タイプ
          </th>

          <th>
            必要な構成
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            無限のトレース
          </td>

          <td>
            構成オプション：

            構成ファイル（ `newrelic.js` ）：

            ```
            distributed_tracing: {
              enabled: true
            }
            infinite_tracing: {
              trace_observer: {
                host: '<a href="/docs/understand-dependencies/distributed-tracing/infinite-tracing/set-trace-observer#ui-endpoints"><var>YOUR_TRACE_OBSERVER_HOST</var></a>'
              }
            }
            ```

            環境変数：

            ```
            NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true
            NEW_RELIC_INFINITE_TRACING_TRACE_OBSERVER_HOST="<var>YOUR_TRACE_OBSERVER_HOST</var>"
            ```
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="php-config"
    title="PHP"
  >
    設定の概要は次のとおりです。構成の詳細について[は、PHPエージェントの分散トレースを](/docs/agents/php-agent/features/distributed-tracing-php-agent)参照してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            タイプ
          </th>

          <th>
            必要な構成
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            無限のトレース
          </td>

          <td>
            構成オプション：

            * 構成ファイル（ `newrelic.ini` ）：

              ```
              newrelic.distributed_tracing_enabled = true
              newrelic.span_events_enabled = true
              newrelic.infinite_tracing.trace_observer.host= "<var><a href="/docs/understand-dependencies/distributed-tracing/infinite-tracing/set-trace-observer#ui-endpoints">YOUR_TRACE_OBSERVER_HOST</a>"</var>
              ```
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="python-config"
    title="Python"
  >
    設定の概要は次のとおりです。構成の詳細については、 [Pythonエージェントの構成](/docs/agents/python-agent/configuration/python-agent-configuration#distributed-tracing-settings)を参照してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            タイプ
          </th>

          <th>
            必要な構成
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            無限のトレース
          </td>

          <td>
            このインストールコマンドを使用してライブラリをプルダウンし、構成ファイルまたは環境変数を設定します。

            ```
            pip install newrelic[infinite-tracing]
            ```

            構成オプション：

            構成ファイル（ `newrelic.ini` ）：

            ```
            distributed_tracing.enabled = true
            infinite_tracing.trace_observer_host= <var>YOUR_TRACE_OBSERVER_HOST</var>
            ```

            環境変数：

            ```
            NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true
            NEW_RELIC_INFINITE_TRACING_TRACE_OBSERVER_HOST="<a href="/docs/understand-dependencies/distributed-tracing/infinite-tracing/set-trace-observer#ui-endpoints"><var>YOUR_TRACE_OBSERVER_HOST</var></a>"
            ```
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="ruby-config"
    title="Ruby"
  >
    設定の概要は次のとおりです。構成の詳細については、 [Rubyエージェントの構成](/docs/agents/ruby-agent/configuration/ruby-agent-configuration#distributed_tracing)を参照してください。

    Infinite Tracingを設定するには、InfiniteTracinggemをインストールする必要があります。このgemは[rubygems.org](https://rubygems.org/gems/newrelic-infinite_tracing)で入手できます。Bundlerを使用するアプリケーションの場合、GemfileにInfiniteTracinggemを追加で含めます。

    ```
    gem 'newrelic-infinite_tracing'
    ```

    Rails3以降または[推奨構成](http://bundler.io/v1.12/rails3.html)のRails2.3を使用している場合、Railsは自動的に`Bundler.require`を呼び出し、アプリケーションの起動時に`newrelic-infinite_tracing`が必要になります。Sinatraまたは別のフレームワークを使用している場合は、手動で`require 'newrelic/infinite_tracing'`を呼び出すか、手動で`Bundler.require`を呼び出す必要があります。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            タイプ
          </th>

          <th>
            必要な構成
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            無限のトレース
          </td>

          <td>
            構成オプション：

            * 構成ファイル（ `newrelic.yml` ）：

              ```
              distributed_tracing: 
                enabled: true
              infinite_tracing: 
                trace_observer: 
                  host: '<a href="/docs/understand-dependencies/distributed-tracing/infinite-tracing/set-trace-observer#ui-endpoints"><var>YOUR_TRACE_OBSERVER_HOST</var></a>'
              ```

            * 環境変数：

              ```
              NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true
              NEW_RELIC_INFINITE_TRACING_TRACE_OBSERVER_HOST="<a href="/docs/understand-dependencies/distributed-tracing/infinite-tracing/set-trace-observer#ui-endpoints"><var>YOUR_TRACE_OBSERVER_HOST</var></a>"
              ```
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>
</CollapserGroup>

#### ステップ4.（オプション）無限トレースをカスタマイズする

エージェント構成設定を追加すると、NewRelicUIにデータが表示されるようになります。データの分析に時間を費やした後、無限トレースの機能のいくつかを調整することをお勧めします。

* [トレースオブザーバーの監視を構成する](/docs/distributed-tracing/infinite-tracing/infinite-tracing-configure-trace-observer-monitoring)
* [スパン属性トレースフィルタを設定する](/docs/distributed-tracing/infinite-tracing/infinite-tracing-configure-span-attribute-trace-filter)
* [ランダムトレースフィルターを構成する](/docs/distributed-tracing/infinite-tracing/infinite-tracing-configure-random-trace-filter)

## 古いAPMエージェントのオプション [#older-agents]

古いAPMエージェントを使用している場合は、このセクションを使用して、必要な分散トレース機能がサポートされているかどうかを確認してください。

互換性情報に続いて、標準の分散トレースをオンにするための基本的な構成設定を示すセクションがあります。古いエージェントがInfiniteTracingをサポートしていて、それを設定する場合は、[上記](#infinite-tracing)の手順を参照してください。

### 互換性ガイド

以下で言語エージェントを検索して、分散トレースで既存のエージェントを使用できるかどうかを確認してください。

<CollapserGroup>
  <Collapser
    id="c-sdk"
    title="CSDK"
  >
    必要なCSDKバージョン[をインストール（コンパイル）](/docs/agents/c-sdk/install-configure/install-c-sdk-compile-link-your-code)または[更新](/docs/agents/c-sdk/install-configure/update-your-c-sdk-library)します。最良の結果を得るには、[最新のCSDKバージョン](/docs/release-notes/agent-release-notes/c-sdk-release-notes)に更新してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "250px" }}>
            オプション
          </th>

          <th>
            CSDKバージョン
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            標準の分散トレース
          </td>

          <td>
            1.1.0以上（W3Cトレースコンテキストは使用できません）
          </td>
        </tr>

        <tr>
          <td>
            無限のトレース
          </td>

          <td>
            利用不可
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="go-version"
    title="Go"
  >
    必要なGoエージェントバージョンを[インストール](/docs/agents/go-agent/installation/install-new-relic-go)または[更新](/docs/agents/go-agent/installation/install-new-relic-go)します。最良の結果を得るには、[最新のGoエージェントバージョン](/docs/release-notes/agent-release-notes/go-release-notes)に更新してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "250px" }}>
            オプション
          </th>

          <th>
            エージェントバージョンに移動
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            標準の分散トレース
          </td>

          <td>
            2.1.0以上

            W3Cトレースコンテキストの場合：3.1.0以上
          </td>
        </tr>

        <tr>
          <td>
            無限のトレース
          </td>

          <td>
            v3.5.0（W3Cトレースコンテキストを含む）

            サポートされている環境：1.9以降に移行
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="java"
    title="Java"
  >
    必要なJavaエージェントバージョンを[インストール](/docs/agents/java-agent/installation/install-java-agent)または[更新](/docs/agents/java-agent/installation/upgrade-java-agent)します。最良の結果を得るには、[最新のJavaエージェントバージョン](/docs/release-notes/agent-release-notes/java-release-notes)に更新してください。

    <Callout variant="important">
      JVMの`networkaddress.cache.ttl`セキュリティ設定を永久または`-1`に設定しないでください。このネットワークプロパティの詳細は、 [OracleNetworkPropertiesのドキュメント](https://docs.oracle.com/javase/7/docs/technotes/guides/net/properties.html)にアクセスしてください。
    </Callout>

    <table>
      <thead>
        <tr>
          <th style={{ width: "250px" }}>
            タイプ
          </th>

          <th>
            Javaエージェントバージョン
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            標準の分散トレース
          </td>

          <td>
            4.3.0以降

            W3Cトレースコンテキストの場合：5.10以降
          </td>
        </tr>

        <tr>
          <td>
            無限のトレース
          </td>

          <td>
            5.12.1以降（W3Cトレースコンテキストを含む）

            サポートされている環境：

            * Java 8：252以降を更新

            * Java9以降のすべてのバージョン

              <Callout variant="tip">
                特別な考慮事項については、「 [無限トレース：Java7および8用のSSLの構成](/docs/understand-dependencies/distributed-tracing/other-requirements/infinite-tracing-configuring-ssl-java-7-8)」を参照してください。
              </Callout>
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="dot-net-version"
    title=".NET"
  >
    必要な.NETエージェントバージョンを[インストール](/docs/agents/net-agent/installation/net-agent-install-introduction)または[更新](/docs/agents/net-agent/installation/update-net-agent)します。最良の結果を得るには、[最新の.NETエージェントバージョン](/docs/release-notes/agent-release-notes/net-release-notes)に更新してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "250px" }}>
            オプション
          </th>

          <th>
            .NETエージェントバージョン
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            標準の分散トレース
          </td>

          <td>
            8.6.45.0以降

            W3Cトレースコンテキストの場合：8.27.139.0以降
          </td>
        </tr>

        <tr>
          <td>
            無限のトレース
          </td>

          <td>
            8.30.0（W3Cトレースコンテキストを含む）

            サポートされている環境：

            * .NETFramework4.5以降
            * .NETCore2.0以降
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="node-version"
    title="Node.js"
  >
    必要なNode.jsエージェントバージョンを[インストール](/docs/agents/nodejs-agent/installation-configuration/install-nodejs-agent)または[更新](/docs/agents/nodejs-agent/installation-configuration/upgrade-nodejs-agent)します。最良の結果を得るには、[最新のNode.jsエージェントバージョン](/docs/release-notes/agent-release-notes/nodejs-release-notes)に更新してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "250px" }}>
            オプション
          </th>

          <th>
            Node.jsエージェントのバージョン
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            標準の分散トレース
          </td>

          <td>
            4.7.0以降

            W3Cトレースコンテキストの場合：6.4以上
          </td>
        </tr>

        <tr>
          <td>
            無限のトレース
          </td>

          <td>
            7.3.0（W3Cトレースコンテキストを含む）

            サポートされる環境：ノードバージョン10.10.0以降
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="php-version"
    title="PHP"
  >
    必要なPHPエージェントバージョンを[インストール](/docs/agents/php-agent/getting-started/introduction-new-relic-php)または[更新](/docs/agents/php-agent/installation/upgrade-php-agent)します。最良の結果を得るには、[最新のPHPエージェントバージョン](/docs/release-notes/agent-release-notes/php-release-notes)に更新してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "250px" }}>
            オプション
          </th>

          <th>
            PHPエージェントバージョン
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            標準の分散トレース
          </td>

          <td>
            8.4以上

            W3Cトレースコンテキストの場合：9.8以上
          </td>
        </tr>

        <tr>
          <td>
            無限のトレース
          </td>

          <td>
            9.12.0.268以上
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="python-version"
    title="Python"
  >
    必要なPythonエージェントバージョンを[インストール](/docs/agents/python-agent/installation/standard-python-agent-install)または[更新](/docs/agents/python-agent/installation-configuration/upgrade-python-agent)します。最良の結果を得るには、[最新のPythonエージェントバージョン](/docs/release-notes/agent-release-notes/python-release-notes)に更新してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "250px" }}>
            オプション
          </th>

          <th>
            Pythonエージェントバージョン
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            標準の分散トレース
          </td>

          <td>
            4.2.0.100以降

            W3Cトレースコンテキストの場合：5.6以降
          </td>
        </tr>

        <tr>
          <td>
            無限のトレース
          </td>

          <td>
            5.12.0.140（W3Cトレースコンテキストを含む）

            サポートされている環境：CPythonのみ（pypyはサポートされていません）
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="ruby-version"
    title="Ruby"
  >
    必要なRubyエージェントバージョンを[インストール](/docs/agents/ruby-agent/installation/install-new-relic-ruby-agent)または[更新](/docs/agents/ruby-agent/installation/update-ruby-agent)します。Infinite Tracingの場合は、 [InfiniteTracinggem](https://rubygems.org/gems/newrelic-infinite_tracing)もインストールする必要があります。最良の結果を得るには、必要に応じて、[最新のRubyエージェントバージョン](/docs/release-notes/agent-release-notes/ruby-release-notes)と[InfiniteTracinggem](https://github.com/newrelic/newrelic-ruby-agent/blob/main/infinite_tracing/CHANGELOG.md)バージョンに更新してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "250px" }}>
            オプション
          </th>

          <th>
            Rubyエージェントバージョン
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            標準の分散トレース
          </td>

          <td>
            [newrelic_rpm5.3.0.346](https://rubygems.org/gems/newrelic_rpm)以降

            W3Cトレースコンテキストの場合： [newrelic_rpm6.9](https://rubygems.org/gems/newrelic_rpm)以降
          </td>
        </tr>

        <tr>
          <td>
            無限のトレース
          </td>

          <td>
            [newrelic_rpm](https://rubygems.org/gems/newrelic_rpm) 7.0.0以降（W3Cトレースコンテキストを含む）

            [newrelic-infinite_tracing7.0.0](https://rubygems.org/gems/newrelic-infinite_tracing)以降

            サポートされる環境：Ruby2.5以降
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>
</CollapserGroup>

### 古いエージェントの標準分散トレースを構成する [#configure-agents]

分散トレースは、構成設定を通じて有効になります。次のエージェント固有のセクションを確認してください。エージェント構成の一般的なヘルプについては、[エージェントの](/docs/agents/manage-apm-agents/configuration/configure-agent)構成を参照してください。

<Callout variant="important">
  サーバー側の構成は、InfiniteTracingでは使用できません。
</Callout>

<CollapserGroup>
  <Collapser
    id="c-sdk-config-standard"
    title="CSDK"
  >
    設定の概要は次のとおりです。構成の詳細については[、「Cアプリケーションの分散トレースを有効にする」を参照してください](/docs/agents/c-sdk/instrumentation/enable-distributed-tracing-your-c-applications)。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            タイプ
          </th>

          <th>
            必要な構成
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            標準の分散トレース
          </td>

          <td>
            構成オプション：

            * `newrelic_app_config_t` 構造：

              ```
              newrelic_app_config_t* config;
              config = newrelic_create_app_config(app_name, license_key);
              config->distributed_tracing.enabled = true;
              ```
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="go-config-standard"
    title="Go"
  >
    設定の概要は次のとおりです。構成の詳細については[、「Goアプリケーションの分散トレースを有効にする」を参照してください](/docs/agents/go-agent/features/enable-distributed-tracing-go-agent)。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            タイプ
          </th>

          <th>
            必要な構成
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            標準の分散トレース
          </td>

          <td>
            構成オプション：

            * `ConfigOption` 構造：

              ```
              newrelic.NewApplication(
                newrelic.ConfigAppName("Example App"),
                newrelic.ConfigLicense(os.Getenv("NEW_RELIC_LICENSE_KEY")),
                newrelic.ConfigDistributedTracerEnabled(true),
              )
              ```

            * 環境変数：

              ```
              NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true
              ```
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="java-config-standard"
    title="Java"
  >
    設定の概要は次のとおりです。構成の詳細については、「 [Javaエージェントの構成：構成ファイル](/docs/agents/java-agent/configuration/java-agent-configuration-config-file)」を参照してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            タイプ
          </th>

          <th>
            必要な構成
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            標準の分散トレース
          </td>

          <td>
            構成オプション：

            * 構成ファイル（ `newrelic.yml` ）（ `common`スタンザの下に2つのスペースをインデント）：

              ```
              distributed_tracing:
                  enabled: true
              ```

            * Javaシステムプロパティ：

              ```
              -Dnewrelic.config.distributed_tracing.enabled=true
              ```

            * 環境変数：

              ```
              NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true
              ```
          </td>
        </tr>

        <tr>
          <td>
            無限のトレース
          </td>

          <td>
            構成オプション：

            * 構成ファイル（ `newrelic.yml` ）（ `common`スタンザの下に2つのスペースをインデント）：

              ```
              distributed_tracing:
                  enabled: true
              infinite_tracing:
                trace_observer:
                  host: <a href="/docs/understand-dependencies/distributed-tracing/infinite-tracing/set-trace-observer#ui-endpoints"><var>"YOUR_TRACE_OBSERVER_HOST"</var></a>
              ```

            * Javaシステムプロパティ：

              ```
              -Dnewrelic.config.distributed_tracing.enabled=true
              -Dnewrelic.config.infinite_tracing.trace_observer.host=<a href="/docs/understand-dependencies/distributed-tracing/infinite-tracing/set-trace-observer#ui-endpoints"><var>"YOUR_TRACE_OBSERVER_HOST"</var></a>
              ```

            * 環境変数：

              ```
              NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true
              NEW_RELIC_INFINITE_TRACING_TRACE_OBSERVER_HOST=<a href="/docs/understand-dependencies/distributed-tracing/infinite-tracing/set-trace-observer#ui-endpoints"><var>"YOUR_TRACE_OBSERVER_HOST"</var></a>
              ```
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="dot-net-config-standard"
    title=".NET"
  >
    設定の概要は次のとおりです。構成の詳細については、 [.NETエージェントの構成](/docs/agents/net-agent/configuration/net-agent-configuration#distributed_tracing)を参照してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            タイプ
          </th>

          <th>
            必要な構成
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            標準の分散トレース
          </td>

          <td>
            構成オプション：

            * 構成ファイル（ `newrelic.config` ）：

              ```
              <configuration . . . >
                 <distributedTracing enabled="true" />
              </configuration>
              ```

            * 環境変数：

              ```
              NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true
              ```
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="node-config-standard"
    title="Node.js"
  >
    設定の概要は次のとおりです。構成の詳細については、 [Node.jsエージェントの構成](/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#distributed-tracing)を参照してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            タイプ
          </th>

          <th>
            必要な構成
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            標準の分散トレース
          </td>

          <td>
            構成オプション：

            構成ファイル（ `newrelic.js` ）：

            ```
            distributed_tracing: {
              enabled: true
            }
            ```

            環境変数：

            ```
            NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true
            ```
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="php-config-standard"
    title="PHP"
  >
    設定の概要は次のとおりです。構成の詳細について[は、PHPエージェントの分散トレースを](/docs/agents/php-agent/features/distributed-tracing-php-agent)参照してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            タイプ
          </th>

          <th>
            必要な構成
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            標準の分散トレース
          </td>

          <td>
            構成オプション：

            * 構成ファイル（ `newrelic.ini` ）：

              ```
              newrelic.distributed_tracing_enabled = true
              ```
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="python-config-standard"
    title="Python"
  >
    設定の概要は次のとおりです。構成の詳細については、 [Pythonエージェントの構成](/docs/agents/python-agent/configuration/python-agent-configuration#distributed-tracing-settings)を参照してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            タイプ
          </th>

          <th>
            必要な構成
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            標準の分散トレース
          </td>

          <td>
            構成ファイル（ `newrelic.ini` ）：

            ```
            distributed_tracing.enabled = true
            ```

            環境変数：

            ```
            NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true
            ```
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>

  <Collapser
    id="ruby-config-standard"
    title="Ruby"
  >
    設定の概要は次のとおりです。構成の詳細については、 [Rubyエージェントの構成](/docs/agents/ruby-agent/configuration/ruby-agent-configuration#distributed_tracing)を参照してください。

    <table>
      <thead>
        <tr>
          <th style={{ width: "200px" }}>
            タイプ
          </th>

          <th>
            必要な構成
          </th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            標準の分散トレース
          </td>

          <td>
            構成オプション：

            * 構成ファイル（ `newrelic.yml` ）：

              ```
              distributed_tracing:
                      enabled: true
              ```

            * 環境変数：

              ```
              NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true
              ```
          </td>
        </tr>
      </tbody>
    </table>
  </Collapser>
</CollapserGroup>

<Callout variant="tip">
  プロキシ設定についてサポートが必要な場合は、 [プロキシサポート](/docs/understand-dependencies/distributed-tracing/other-requirements/infinite-tracing-proxy-support)を参照してください。
</Callout>

## 手動計装（自動計装が機能しない場合） [#manual-instrumentation]

**推奨事項：**カスタムインストルメンテーションを実行する前に、以下をお読みください。

* [分散トレースのしくみ](/docs/apm/distributed-tracing/getting-started/how-new-relic-distributed-tracing-works)
* [不足しているデータのトラブルシューティング](/docs/apm/distributed-tracing/troubleshooting/troubleshooting-missing-trace-data)

サービスがトレースヘッダーを他のサービスに渡していない場合は、分散トレースペイロードAPIを使用して、[呼び出し元のサービス](#calling-service)と[呼び出され](#called-service)たサービスをインストルメント化できます。呼び出し元のサービスは、API呼び出しを使用してペイロードを生成します。このペイロードは、呼び出されたサービスによって受け入れられます。

<CollapserGroup>
  <Collapser
    id="calling-service"
    title="通話サービスを計測する"
  >
    通話サービスをインストルメント化するには：

    1. 発呼側サービスをモニター[するAPMエージェントのバージョンが](#compatibility-requirements)分散トレースをサポートしていることを確認してください。

    2. 分散トレースペイロードを生成するためのエージェントAPI呼び出しを呼び出し[ます。CSDK](/docs/agents/c-sdk/instrumentation/enable-distributed-tracing-your-c-applications) \|[Go](/docs/agents/go-agent/features/distributed-tracing-go#create-manually)\| [Java](/docs/agents/java-agent/api-guides/guide-using-java-agent-api#trace-calls) \| [.NET](/docs/agents/net-agent/net-agent-api/itransaction/#insertdistributedtraceheaders) \| [Node.js](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#transaction-handle-createDistributedTracePayload) \| [PHP](/docs/agents/php-agent/features/distributed-tracing-php#manual) \| [Python](/docs/agents/python-agent/python-agent-api/create_distributed_trace_payload) \| [Ruby](/docs/agents/ruby-agent/api-guides/guide-using-ruby-agent-api#distributed) 。

       <Callout variant="important">
         トレース内のスパンの適切な順序を維持**するには、ペイロードを送信するスパンのコンテキストでペイロードを生成するようにして**ください。
       </Callout>

    3. そのペイロードを宛先サービスに対して行われた呼び出しに追加します（たとえば、ヘッダーで）。

    4. （オプション）コールを外部コールとして識別します。

       * [CSDK](https://github.com/newrelic/c-sdk/blob/master/GUIDE.md#distributed-tracing)
       * [Go](/docs/agents/go-agent/get-started/instrument-go-segments#go-external-segments)
       * [Java](https://newrelic.github.io/java-agent-api/javadoc/index.html?com/newrelic/api/agent/TracedMethod.html)
       * .NET：該当なし
       * [Node.js](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#custom-instrumentation-api)
       * PHP：該当なし
       * [Python](/docs/agents/python-agent/python-agent-api/external-trace)
       * [Ruby](/docs/agents/ruby-agent/api-guides/guide-using-ruby-agent-api#externals)
  </Collapser>

  <Collapser
    id="called-service"
    title="呼び出されたサービスを計測する"
  >
    呼び出されたサービスをインストルメント化するには：

    1. 呼び出されたサービスを監視[するAPMエージェントのバージョンが](#compatibility-requirements)分散トレースをサポートしていることを確認します。

    2. 呼び出されたサービスのNewRelicエージェントがNewRelicトランザクションを識別しない場合は、エージェントAPIを使用してトランザクションを宣言します。

       <CollapserGroup>
         <Collapser
           id="c-sdk-create"
           title="CSDK"
         >
           トランザクションが進行中でないことを示す1つの方法： `newrelic_create_distributed_trace_payload()`が呼び出されると、 `NULL`ポインターが返されます。この問題を解決するには、手順に従ってCSDKを[使用してトランザクションを作成し](/docs/agents/c-sdk/instrumentation/instrument-your-app-c-sdk)ます。
         </Collapser>

         <Collapser
           id="go-create"
           title="Go"
         >
           トランザクションが進行中でないことを示す1つの方法： `Transaction.InsertDistributedTraceHeaders(h http.Header)`が呼び出されると、ヘッダーは挿入されません。トランザクションを作成するには、 [InstrumentGo](/docs/agents/go-agent/instrumentation/instrument-go-transactions)トランザクションを参照してください。
         </Collapser>

         <Collapser title="Java">
           トランザクションが進行中でないことを示す1つの方法： `Transaction.insertDistributedTraceHeaders(Headers)`が呼び出されると、ヘッダーは挿入されません（このAPIにはエージェント6.4.0以降が必要です）。トランザクションを作成するには、 [Javaエージェントのトランザクション関連のAPI](/docs/agents/java-agent/api-guides/guide-using-java-agent-api#transactions)を参照してください。
         </Collapser>

         <Collapser
           id="dotnet-create"
           title=".NET"
         >
           トランザクションが進行中でないことを示す1つの方法： `CreateDistributedTracePayload()`は[空のペイロード](/docs/agents/net-agent/net-agent-api/idistributedtracepayload)を返します。トランザクションを作成するには、 [.NETカスタムインストルメンテーションの概要を](/docs/agents/net-agent/custom-instrumentation/introduction-net-custom-instrumentation)参照してください。
         </Collapser>

         <Collapser
           id="node-create"
           title="Node.js"
         >
           トランザクションが進行中でないことを確認する1つの方法：Node.jsエージェントログは次のようなエラーを報告します。

           ```
           No transaction found when calling Transaction.acceptDistributedTracePayload.
           ```

           [`startWebTransaction`](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#startWebTransaction)を使用してWebトランザクションを作成するか、 [`startBackgroundTransaction`](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#startBackgroundTransaction)を使用して[非Webトランザクション](/docs/apm/transactions/intro-transactions/monitor-background-processes-other-non-web-transactions)をキャプチャします。
         </Collapser>

         <Collapser
           id="php-create"
           title="PHP"
         >
           トランザクションが進行中でないことを示す1つの方法： `newrelic_insert_distributed_trace_headers()`は`false`を返します。トランザクションを作成するには、 [newrelic_start_transaction](/docs/agents/php-agent/php-agent-api/newrelic_start_transaction)を参照してください。
         </Collapser>

         <Collapser
           id="python-create"
           title="Python"
         >
           トランザクションが進行中でないことを通知するには： `transaction = current_transaction()`が実行されると、 `transaction`は`None`になります。または、 `result = accept_distributed_trace_payload(payload)`を実行すると、結果は`False`になります。

           [非Webトランザクション](/docs/apm/transactions/intro-transactions/monitor-background-processes-other-non-web-transactions#define)を報告するには、 [`background_task`](/docs/agents/python-agent/python-agent-api/background_task)を使用します。Pythonインストルメンテーションの詳細については、「[トランザクションとセグメントの監視」](/docs/agents/python-agent/api-guides/guide-using-python-agent-api#transaction-segments)を参照してください。
         </Collapser>

         <Collapser
           id="ruby-create"
           title="Ruby"
         >
           RackベースのWebフレームワークを使用していて、New RelicのRackインストルメンテーションを有効にしている場合、Rubyエージェントがトランザクションの開始を処理します。その他の使用例については、 [`add_transaction_tracer` APIメソッド](/docs/agents/ruby-agent/api-guides/ruby-custom-instrumentation#transaction-tracers)を参照してください。
         </Collapser>
       </CollapserGroup>

    3. 受信した呼び出しからペイロードを抽出します（たとえば、ヘッダーで）。

    4. ペイロードを受け入れるための呼び出しを呼び出し[ます。CSDK](/docs/agents/c-sdk/instrumentation/enable-distributed-tracing-your-c-applications) \|[Go](/docs/agents/go-agent/features/distributed-tracing-go#create-manually)\| [Java](/docs/agents/java-agent/api-guides/guide-using-java-agent-api#trace-calls) \| [.NET](/docs/agents/net-agent/net-agent-api/itransaction/#acceptdistributedtraceheaders) \| [PHP](/docs/agents/php-agent/features/distributed-tracing-php#manual) \| [Node.js](/docs/agents/nodejs-agent/api-guides/nodejs-agent-api#transaction-handle-acceptDistributedTracePayload) \| [Python](/docs/agents/python-agent/python-agent-api/accept_distributed_trace_payload) \| [Ruby](/docs/agents/ruby-agent/api-guides/guide-using-ruby-agent-api#distributed) 。
  </Collapser>
</CollapserGroup>