---
title: '.NET: Configure logs in context'
tags:
  - Logs
  - Enable log management in New Relic
  - Logs in context for .NET
metaDescription: For apps monitored by the .NET agent, learn how to link log data with related data across the rest of the New Relic platform.
redirects:
  - /docs/logs/new-relic-logs/enable-logs-context/enable-logs-context-net
  - /docs/logs/enable-logs/logs-context-net/configure-logs-context-net
  - /docs/logs/enable-log-monitoring-new-relic/logs-context-net/configure-logs-context-net
  - /docs/logs/enable-log-management-new-relic/configure-logs-context/configure-logs-context-net
---

Logs in context for the .NET agent connects your logs and APM data in New Relic. Bringing all of this data together in a single tool helps you quickly get to the root cause of an issue and find the log lines that you need to identify and resolve a problem.

## Example [#example-net]

The following diagram illustrates the flow of log messages through Apache log4net, highlighting specific components of the New Relic log4net extension. This workflow is similar for the nLog and Serilog extensions for logs in context.

![Logs In Context - Log4Net](./images/LogsInContext---Log4Net.jpg "log4net extension for logs in context")

**Appender:** The `NewRelicAppender` adds contextual information from the .NET agent (using the API) to the log events generated by the application. This contextual information, known as linking metadata, is used by New Relic to link log messages to the transactions and spans from which they were created. This appender will pass the enriched log events to downstream appenders for further processing.

Since the `NewRelicAppender` is `ForwardingAppender` type, it needs to be the first appender in the chain. It also requires another appender that can write to an actual output destination as its child in order to work.

**Layout:** The `NewRelicLayout` formats the enriched log events into the JSON format expected by New Relic. The appender, which this layout is assigned to, instructs log4net to output the JSON to a file in the location that the log forwarder expects.

**Log Forwarder**: The log forwarder monitors an output folder and incrementally sends New Relic formatted Log information to the New Relic Logging endpoint. There are many log forwarders available. This example uses [Fluentd](https://www.fluentd.org/).

## Set up your .NET app [#configure-net]

To enable logs in context for APM apps monitored by .NET:

1. Make sure you have already [set up logging in New Relic](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/enable-log-management-new-relic/). This includes configuring a supported log forwarder that collects your application logs and extends the metadata that is forwarded to New Relic.
2. [Install](/docs/agents/net-agent/installation/introduction-net-agent-install) or [update](//docs/agents/net-agent/installation/update-net-agent) to the latest .NET agent version, and [enable distributed tracing](/docs/distributed-tracing/enable-configure/quick-start/). Use [.NET agent version 8.21 or higher](/docs/release-notes/agent-release-notes/net-release-notes/) and the [New Relic .NET agent API version 8.21 or higher](/docs/agents/net-agent/net-agent-api)for logs in context.
3. Install or update to Microsoft [.NET Framework 4.5 or higher](https://dotnet.microsoft.com/download/dotnet-framework) or [.NET Core 2.0 or higher](https://dotnet.microsoft.com/download/dotnet-core).
4. Install and configure any of the following logging extensions to enrich your log data.

<CollapserGroup>
  <Collapser
    id="log4net"
    title="Apache log4net 2.0.8 or higher"
  >

  Use the [Apache log4net version 2.0.8 or higher](https://logging.apache.org/log4net/) extension to link your log data with related data across the rest of the New Relic platform.

  Log4net uses `appender` and `layout` to store and format log messages. [`NewRelicAppender`](https://github.com/newrelic/newrelic-logenricher-dotnet/tree/master/src/Log4Net) enriches log messages with contextual information from the New Relic .NET agent if it is attached to your application. The appender passes enriched log messages to downstream appenders to handle specific use cases for log messages.
  
  For more information about logging with log4net, see the Apache log4net [Getting started](https://logging.apache.org/log4net/) documentation.

  To configure logs in context with the log4net extension:

  1. Using the Visual Studio [NuGet Package Manager](https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-visual-studio), locate and install the [`NewRelic.LogEnrichers.Log4Net`](https://www.nuget.org/packages/NewRelic.LogEnrichers.Log4Net/) package.

  2. In your log4net configuration file, update your logging configuration to use the `NewRelicAppender` as the first level appender, and reference your existing appenders as its children. Also replace the layout of the appender that writes log messages to an output destination with the `NewRelicLayout`.

  The following log4net configuration example enriches log events with New Relic linking metadata. In addition to the existing log files, it outputs new log files in a specific JSON format at `C:\logs\log4netExample.log.json` for consumption by the log forwarder:

  ```
  <log4net>
    <root>
      <level value="ALL" />
      <appender-ref ref="NewRelicAppender" />
    </root>

    <appender name="NewRelicAppender" type="NewRelic.LogEnrichers.Log4Net.NewRelicAppender, NewRelic.LogEnrichers.Log4Net" >
      <threshold value="ALL"/>
      <appender-ref ref="FileAppender" />
    </appender>

    <appender name="FileAppender" type="log4net.Appender.FileAppender">
      <file value="C:\logs\log4netExample.log.json" />
      <param name="AppendToFile" value="true" />
      <layout type="NewRelic.LogEnrichers.Log4Net.NewRelicLayout, NewRelic.LogEnrichers.Log4Net">
      </layout>
    </appender>
  </log4net>
  ```

  After you configure the log4net extension and update your logging file, you can configure your extension to send data to New Relic. Here is an example configuration using the Fluentd plugin for New Relic Logs:

  ```
  <!--NewRelicLoggingExample.conf-->
  <source>
      @type tail 
      path C:\logs\log4netExample.log.json
      pos_file C:\logs\log4netExample.log.json.pos
      tag logfile.*
    <parse> 
      @type json
    </parse>
  </source>
    <match **> 
      @type newrelic
      license_key <YOUR NEW_RELIC_LICENSE_KEY>
      base_uri https://log-api.newrelic.com/log/v1
    </match>
  ```

  </Collapser>

  <Collapser
    id="NLog"
    title="NLog"
  >

  text

  </Collapser>

  <Collapser
    id="serilog"
    title="Serilog]"
  >

  text

  </Collapser>

</CollapserGroup>

## View logs in the UI [#view-test]

To verify that you have configured the log appender correctly, run your application, then check your [logs data in New Relic One](/docs/logs/log-management/ui-data/use-logs-ui/) using the query operator `has:span.id has:trace.id`.

If everything is configured correctly and your data is being forwarded to New Relic with the enriched metadata, your logs should now be emitted as JSON and contain `trace.id` and `span.id` fields. If you don't see log data in the UI, follow the [troubleshooting procedures](/docs/logs/log-management/troubleshooting/no-log-data-appears-ui/).

## What's next? [#what-next]

After you set up APM logs in context, make the most of your logging data:

* Explore the logging data across your platform with our [Logs UI](/docs/logs/log-management/ui-data/use-logs-ui/).
* See your logs in context of your app's performance in the [APM UI](/docs/logs/log-management/ui-data/use-logs-ui/#links). Troubleshoot [errors](/docs/apm/apm-ui-pages/error-analytics/errors-page-find-fix-verify-problems/) with [distributed tracing](/docs/apm/distributed-tracing/ui-data/understand-use-distributed-tracing-data), stack traces, application logs, and more.
* Get deeper visibility into both your application and your platform performance data by forwarding your logs with our [infrastructure monitoring agent](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/forward-your-logs-using-infrastructure-agent/). Review your [infrastructure logs](/docs/logs/log-management/ui-data/use-logs-ui/#links) in the UI.
* Set up [alerts](/docs/alerts-applied-intelligence/new-relic-alerts/alert-conditions/create-alert-conditions/).
* [Query your data](/docs/query-your-data/explore-query-data/get-started/introduction-querying-new-relic-data/) and [create dashboards](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards/).


