---
title: Configure logs in context with APM agents
tags:
  - Logs
  - Enable log management in New Relic
  - Configure logs in context
metaDescription: Link your log data with related data across the rest of the New Relic platform by configuring logs in context with APM extensions.
redirects:
  - /docs/enable-logs-context-logs
  - /docs/enable-apm-logs-context-logs
  - /docs/logs/new-relic-logs/enable-logs-context/enable-apm-logs-context-logs
  - /docs/logs/new-relic-logs/enable-logs-context/enable-logs-context-apm-agents
  - /node/36951
  - /docs/logs/enable-logs/configure-logs-context/configure-logs-context-apm-agents
  - /docs/logs/enable-log-monitoring-new-relic/configure-logs-context/configure-logs-context-apm-agents
  - /docs/logs/new-relic-logs/enable-logs-context
  - /docs/logs/new-relic-logs/apm-integration
  - /docs/logs/log-monitoring/apm-integration
  - /docs/logs/log-management/apm-integration
  - /docs/logs/new-relic-logs/enable-logs/2-configure-logs-context-apm-agents
  - /docs/logs/log-monitoring/enable-logs/configure-logs-context-apm-agents
---

When you need to correlate log data with other telemetry data, enable logs in context in New Relic. Logs in context adds metadata that links your logs with related APM data, like [errors](/docs/apm/apm-ui-pages/error-analytics/errors-page-find-fix-verify-problems/) or [distributed traces](/docs/apm/distributed-tracing/ui-data/understand-use-distributed-tracing-data), or your platform performance data from infrastructure monitoring in New Relic One.

## See the root cause of issues across your platform [#compatibility-requirements]

By bringing all of your application and infrastructure data together in a single solution, you can get to the root cause of issues faster. Logs in context help you quickly see meaningful patterns and trends.

Don't spend extra time trying to narrow down all your logs from different parts of your platform. Instead, enable logs in context to see the exact log lines you need to identify and resolve a problem.

## Basic process to enable logs in context [#enable-logs]

The process to enable logs in context is basically the same, regardless of which APM agent you use to monitor your application:

1. Update to a supported APM agent version for your app, and enable [distributed tracing](/docs/understand-dependencies/distributed-tracing/enable-configure/enable-distributed-tracing/).
2. Configure a [supported log forwarder](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/enable-log-management-new-relic/) to collect your application logs and extend the metadata that is forwarded to New Relic.
3. Configure logs in context for your APM agent, as explained in this document, or for your [infrastructure monitoring agent](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/forward-your-logs-using-infrastructure-agent/).
4. View your logs within the context of your apps or infrastructure in [New Relic One](/docs/logs/log-management/ui-data/use-logs-ui/#links).

The main differences in this procedure are which log appenders you can use to extend and enrich your log data, and how to configure the log appender you select for your APM agent.

## C SDK [#enable-c-sdk]

Logs in context is not available for apps monitored by the C SDK. Instead, you can build your own logging extension library by using the [Log API](/docs/logs/log-management/log-api/introduction-log-api/).

To [enable distributed tracing](/docs/distributed-tracing/enable-configure/language-agents-enable-distributed-tracing/#update-agents) for apps monitored by the C SDK, [install](/docs/agents/c-sdk/install-configure/install-c-sdk-compile-link-your-code/) or [update](/docs/agents/c-sdk/install-configure/update-your-c-sdk-library/) to the latest C SDK version. Use [C SDK version 1.1.0 or higher](/docs/release-notes/agent-release-notes/c-sdk-release-notes/) for distributed tracing.

## Go [#enable-go]

To enable logs in context for APM apps monitored by Go:

1. [Install](/docs/agents/go-agent/installation/install-new-relic-go/) or [update](/docs/agents/go-agent/installation/update-go-agent/) to the latest Go agent version, and [enable distributed tracing](/docs/distributed-tracing/enable-configure/language-agents-enable-distributed-tracing/#update-agents). Use [Go agent version 2.12 or higher](/docs/release-notes/agent-release-notes/go-release-notes/) for logs in context.
2. Configure a [supported log forwarder](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/enable-log-management-new-relic/) to collect your application logs and extend the metadata that is forwarded to New Relic with logs in context.
3. Install the [Logrus logging framework version 1.4.0 or higher](https://github.com/sirupsen/logrus) to enrich your log data.
4. Configure logs in context for Go using the Logrus extension.

<CollapserGroup>
  <Collapser
    id="go-configure"
    title="Go configuration with Logrus"
  >

1. Import the following packages in files where Logrus is configured:

   ```
   import (
       log "github.com/sirupsen/logrus"
       "github.com/newrelic/go-agent/v3/integrations/logcontext/nrlogrusplugin"
       "github.com/newrelic/go-agent/v3/newrelic"
   )
   ```
2. Set the Logrus formatter to `nrlogrusplugin.ContextFormatter`:

   ```
   logger := log.New()
   logger.SetFormatter(nrlogrusplugin.ContextFormatter{})
   ```

   OR

   If you're using the Logrus standard logger:

   ```
   log.SetFormatter(nrlogrusplugin.ContextFormatter{})
   ```

   The logger will now look for a `newrelic.Transaction` inside its context and decorate logs accordingly.
3. Update your standard logging call to include contextual logging, and pass this to the logger.

   For example, instead of `logger.Info("Hello New Relic!")`, use

   ```
   ctx := newrelic.NewContext(context.Background(), txn)
   logger.WithContext(ctx).Info("Hello New Relic!")
   ```

   where `txn` is the current running transaction.

  </Collapser>

</CollapserGroup>

4. To verify that you have configured the log appender correctly, run your application, then check your [logs data in New Relic One](/docs/logs/log-management/ui-data/use-logs-ui/) using the query operator `has:span.id has:trace.id`.

If everything is configured correctly and your data is being forwarded to New Relic with the enriched metadata, your logs should now be emitted as JSON and contain `trace.id` and `span.id` fields.

## Java [#enable-java]

To enable logs in context for APM apps monitored by Java:

1. [Install](/docs/agents/java-agent/installation/install-java-agent/) or [update](/docs/agents/java-agent/installation/update-java-agent/) to the latest Java agent version, and [enable distributed tracing](/docs/distributed-tracing/enable-configure/language-agents-enable-distributed-tracing/#update-agents). Use [Java agent version 5.6.0 or higher](/docs/release-notes/agent-release-notes/java-release-notes/) for logs in context.
2. Configure a [supported log forwarder](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/enable-log-management-new-relic/) to collect your application logs and extend the metadata that is forwarded to New Relic with logs in context.
3. Install any of the following log appenders to enrich your log data:
    * Dropwizard 1.3 or higher
    * Log4j 1.x
    * Log4j 2.x
    * Logback 1.2.0 or higher
    * java.util.logging with classpath additions if necessary
  If you use Spring or Spring Boot and aren't sure which extension you need, see our [Spring documentation](/docs/logs/enable-log-management-new-relic/configure-logs-context-apm-agents/#java-spring).  
4. Configure logs in context for Java with your selected log extension.
5. To verify that you have configured the log appender correctly, run your application, then check your [logs data in New Relic One](/docs/logs/log-management/ui-data/use-logs-ui/) using the query operator `has:span.id has:trace.id`.

If everything is configured correctly and your data is being forwarded to New Relic with enriched metadata, your logs should now be emitted as JSON and contain `trace.id` and `span.id` fields.

## .NET [#enable-net]

To enable logs in context for APM apps monitored by .NET:

1. [Install](/docs/agents/net-agent/installation/introduction-net-agent-install/) or [update](/docs/agents/net-agent/installation/update-net-agent/) to the latest .NET agent version, and [enable distributed tracing](/docs/distributed-tracing/enable-configure/language-agents-enable-distributed-tracing/#update-agents). Version requirements:

   * [New Relic .NET agent 8.21 or higher](/docs/release-notes/agent-release-notes/net-release-notes)
   * [New Relic .NET agent API 8.21 or higher](/docs/agents/net-agent/net-agent-api)
   * Microsoft [.NET Framework 4.5 or higher](https://dotnet.microsoft.com/download/dotnet-framework)
   * Microsoft [.NET Core 2.0 or higher](https://dotnet.microsoft.com/download/dotnet-core)
2. Configure a [supported log forwarder](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/enable-log-management-new-relic/) to collect your application logs and extend the metadata that is forwarded to New Relic with logs in context.
3. Install any of the following log appenders to enrich your log data:
    * log4net
    * NLog
    * Serilog

4. Configure logs in context for .NET with your selected log extension:
5. To verify that you have configured the log appender correctly, run your application, then check your [logs data in New Relic One](/docs/logs/log-management/ui-data/use-logs-ui/) using the query operator `has:span.id has:trace.id`.

If everything is configured correctly and your data is being forwarded to New Relic with enriched metadata, your logs should now be emitted as JSON and contain `trace.id` and `span.id` fields.

## Node.js [#enable-nodejs]

To enable logs in context for APM apps monitored by Node.js:

1. [Install](/docs/agents/nodejs-agent/installation-configuration/install-nodejs-agent/) or [update](/docs/agents/nodejs-agent/installation-configuration/update-nodejs-agent/) to the latest Node.js agent version, and [enable distributed tracing](/docs/distributed-tracing/enable-configure/language-agents-enable-distributed-tracing/#update-agents). Use [Node.js agent version 1.4.0 or higher](/docs/release-notes/agent-release-notes/nodejs-release-notes/) for logs in context.
2. Configure a [supported log forwarder](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/enable-log-management-new-relic/) to collect your application logs and extend the metadata that is forwarded to New Relic with logs in context.
3. Install the [Winston logging framework version 3.0.0 or higher](https://github.com/winstonjs/winston) to enrich your log data.
4. Configure logs in context for Node.js using the Winston extension.

<CollapserGroup>
  <Collapser
    id="nodejs-configure"
    title="Node.js configuration with Winston"
  >

  1. To install the Winston log enricher, enter the following command into your terminal or command line interface:

    ```
    npm install @newrelic/winston-enricher
    ```
  2. In your application code, update your logging configuration to add the `newrelicFormatter`:

    ```
    // index.js
    require('newrelic')
    const newrelicFormatter = require('@newrelic/winston-enricher')
    ```

  The New Relic formatter can be used individually or combined with other formatters as the final format.
  
    ```
    format: winston.format.combine(
      winston.format.label({label: 'test'}),
      newrelicFormatter()
    )
    ```
  </Collapser>
</CollapserGroup>

5. To verify that you have configured the log appender correctly, run your application, then check your [logs data in New Relic One](/docs/logs/log-management/ui-data/use-logs-ui/) using the query operator `has:span.id has:trace.id`.

If everything is configured correctly and your data is being forwarded to New Relic with enriched metadata, your logs should now be emitted as JSON and contain `trace.id` and `span.id` fields.

## PHP [#enable-php]

To enable logs in context for APM apps monitored by PHP:

1. Make sure your PHP agent supports logs in context (agent version 9.13.0.270 or higher) and has [distributed tracing enabled](/docs/distributed-tracing/enable-configure/language-agents-enable-distributed-tracing/).
2. Install [Monolog](https://github.com/Seldaek/monolog) version 1 or 2, or use a compatible log forwarding plugin if you are not using the built-in Monolog Handler for New Relic.
3. Configure logs in context for PHP using the Monolog extension, if used.

<CollapserGroup>
  <Collapser
    id="php-configure"
    title="PHP configuration with Monolog"
  >

You must install the Monolog log enricher package before you can configure Monolog for New Relic logs in context. This is done by using Composer to install the [`newrelic/monolog-enricher`](https://packagist.org/packages/newrelic/monolog-enricher) package.

In most cases, use the `Processor` and `Handler` classes provided by the log enricher package in conjunction with Monolog's built-in `BufferHandler`.

  * The `Processor` adds the contextual metadata required for New Relic logs in context to operate.
  * The `Handler` sends the log records to New Relic Logs.
  * The `BufferHandler` ensures that the logs are delivered with as little overhead as possible.

At the point where you create the `Monolog\Logger` object, add the following `pushProcessor` and `pushHandler` calls to add the `Processor` and `Handler`:

```
<?php

use Monolog\Handler\BufferHandler;
use Monolog\Logger;
use NewRelic\Monolog\Enricher\{Handler, Processor};

$log = new Logger('log');
$log->pushProcessor(new Processor);
$log->pushHandler(new BufferHandler(new Handler));
```

<Callout variant="tip">
  You can use the `Processor` and `Handler` in conjunction with any existing Monolog setup. You do not need to remove your existing processors and handlers.
</Callout>

  </Collapser>
  <Collapser
    id="php-advanced"
    title="PHP configuration with other log forwarders"
  >

If you use Monolog to send logs to a compatible log forwarder, and you have already configured that tool to send logs to New Relic, you can use the `Processor` and `Formatter` solely for that tool. This option prevents additional overhead of sending logs directly to New Relic with the `Handler`.

You will need to be using a handler that supports the `setFormatter()` method, and your logging tool must be able to ingest JSON logs.

Here's an example of configuring Monolog to handle other log forwarders:

```
<?php

use Monolog\Handler\StreamHandler;
use Monolog\Logger;
use NewRelic\Monolog\Enricher\{Formatter, Processor};

$log = new Logger('log');
$log->pushProcessor(new Processor);

$handler = new StreamHandler('php://stderr');
$handler->setFormatter(new Formatter);
$log->pushHandler($handler);
```
  </Collapser>

</CollapserGroup>

4. To verify that you have configured the log forwarder extension correctly, run your application and verify that the logging you have configured contains the following:

   * Includes `trace.id` and `span.id` fields
   * Has properly-formatted JSON lines

If everything is configured correctly and your data is being reported, you should see data in the [New Relic Logs UI](/docs/logs/log-management/ui-data/use-logs-ui/) using the query operator `has:span.id has:trace.id`.

If the logs from your application do not include fields like `trace.id` and `span.id`, there may be a problem with the configuration of the Monolog log enricher. In this situation, check that:

* The application is using the Monolog logger object when sending log records, not `syslog()`.
* The PHP agent has been [installed](/docs/agents/php-agent/installation/php-agent-installation-overview) and is configured to [enable distributed tracing](/docs/understand-dependencies/distributed-tracing/enable-configure/enable-distributed-tracing).
* Another Monolog handler is not preventing the log record from [bubbling](https://github.com/Seldaek/monolog/blob/master/doc/01-usage.md#core-concepts).

## Python [#enable-python]

To enable logs in context for APM apps monitored by Python:

1. Make sure your Python agent supports logs in context (agent version 5.4.0 or higher) and has [distributed tracing enabled](/docs/distributed-tracing/enable-configure/language-agents-enable-distributed-tracing/).
2. Configure the Python logging framework to use the `NewRelicContextFormatter`.

<CollapserGroup>
  <Collapser
    id="python-configure"
    title="Python configuration"
  >

Enabling logs in Python is as simple as instantiating a log formatter and adding it to your log handler. The following example uses a `StreamHandler` which by default writes logs to `sys.stderr`, but you can use any handler. For more information about configuring log handlers, see the [Python.org documentation](https://docs.python.org/3/library/logging.handlers.html).

```
# Import the logging module and the New Relic log formatter
import logging
from newrelic.agent import NewRelicContextFormatter

# Instantiate a new log handler
handler = logging.StreamHandler()

# Instantiate the log formatter and add it to the log handler
formatter = NewRelicContextFormatter()
handler.setFormatter(formatter)

# Get the root logger and add the handler to it
root_logger = logging.getLogger()
root_logger.addHandler(handler)
```
  </Collapser>

</CollapserGroup>

3. To verify that you have configured the log forwarder extension correctly, run your application and verify that the logging you have configured contains the following:

   * Includes `trace.id` and `span.id` fields
   * Has properly-formatted JSON lines

If everything is configured correctly and your data is being reported, you should see data in the [New Relic Logs UI](/docs/logs/log-management/ui-data/use-logs-ui/) using the query operator `has:span.id has:trace.id`.

## Ruby [#enable-ruby]

To enable logs in context for APM apps monitored by Ruby:

1. Make sure your Ruby agent supports logs in context (agent version 6.7.0 or higher) and has [distributed tracing enabled](/docs/distributed-tracing/enable-configure/language-agents-enable-distributed-tracing/).
2. If applicable, make sure you're using a [supported Rails version](/docs/agents/ruby-agent/getting-started/ruby-agent-requirements-supported-frameworks#web_frameworks).
3. Configure logs in context for Ruby.

<CollapserGroup>
  <Collapser
    id="ruby-rails-configure"
    title="Rails configuration"
  >

Rails logging is controlled by two components:

 * A logger that is customizable by setting `config.logger`
 * A log formatter that is customizable by setting `config.log_formatter`
 
In most cases, you can configure logs in context by setting `config.log_formatter` to the `DecoratingFormatter` in your Rails application. For more information about Rails configuration, see the [rubyonrails.org documentation](https://guides.rubyonrails.org/configuring.html).

In your application's config, require `'newrelic_rpm'`, then add the following line:

```
module ________
  class Application < Rails::Application

    ...

    config.log_formatter = ::NewRelic::Agent::Logging::DecoratingFormatter.new
  end
end
```

This will use the New Relic log forwarder to format log messages, but the rest of the logging configuration will be provided by the other Rails config settings.

  </Collapser>

  <Collapser
    id="ruby-other-logger"
    title="Replacing the Rails logger"
  >

If setting the `log_formatter` option doesn't meet your needs, replace the entire Rails logger with an instance of the New Relic logger. Provide the parameters to the logger's constructor, like this:

```
module ________
  class Application < Rails::Application

    ...

    config.logger = ::NewRelic::Agent::Logging::DecoratingLogger.new(
      "log/application.log", #etc...
    )
  end
end
``` 
  </Collapser>

  <Collapser
    id="ruby-non-rails-configuration"
    title="Non-Rails configuration"
  >

For non-Rails applications, use the `DecoratingLogger` in place of the Ruby standard `::Logger`, like this:

```
logger = ::NewRelic::Agent::Logging::DecoratingLogger.new(
  'log/application.log', #etc...
)
...
  
logger.info(...)
```

The `DecoratingLogger` is a drop-in replacement for the Ruby standard `::Logger`. Their constructors accept the same parameters.
  </Collapser>

  <Collapser
    id="ruby-lograge-configuration"
    title="Lograge configuration"
  >

To configure our logging extension with the [lograge gem](https://rubygems.org/gems/lograge), no additional configuration is required.
  </Collapser>

  <Collapser
    id="ruby-advanced-configuration"
    title="Other loggers configuration"
  >

To use our logging extension with a different logging implementation or with your own custom logger, use the `DecoratingFormatter`. For example:

```
module ________
  class Application < Rails::Application

    ...

    config.logger = ::YourCustomLoggerImplementation.new(
      $stdout,
      formatter: ::NewRelic::Agent::Logging::DecoratingFormatter.new
    )
  end
end
```
  </Collapser>

</CollapserGroup>

4. To verify that you have configured the log forwarder extension correctly, run your application and verify that the logging you have configured contains the following:

   * Includes `trace.id` and `span.id` fields
   * Has properly-formatted JSON lines

If everything is configured correctly and your data is being reported, you should see data in the [New Relic Logs UI](/docs/logs/log-management/ui-data/use-logs-ui/) using the query operator `has:span.id has:trace.id`.

Logs in context for Ruby does not support tagged logging. If you are initializing your logger with a `log_tags` argument, your custom tags may not appear on the final version of your logs.

## Agent API [#enable-api]

If you use a logging framework not covered by our existing logs-in-context solutions, you can use your APM agent API. This solution passes the linking metadata required to automatically correlate logs with errors and traces.

You can also build your own logging extension library for any language/logging framework by using the APM agent API or the [Log API](/docs/logs/log-management/log-api/introduction-log-api/).

## Troubleshooting [#troubleshooting]

Follow these troubleshooting steps as applicable.

<CollapserGroup>
  <Collapser
    id="missing-data"
    title="Log data is incomplete"
  >

  **Problem:** Not all log data in a message or for a specific attribute is being displayed.
  
  **Solution:** The stack trace will be written to the `error.stack` property. To accommodate New Relic's 4000-character log line limit, the stack and trace properties will be removed and the `message`, `error.message`, and `error.stack` values will be truncated to 1024 characters.

  </Collapser>

</CollapserGroup>

## What's next? [#what-next]

After you set up APM logs in context, make the most of your logging data:

* Explore the logging data across your platform with our [Logs UI](/docs/logs/log-management/ui-data/use-logs-ui/).
* See your logs in context of your app's performance in the [APM UI](/docs/logs/log-management/ui-data/use-logs-ui/#links). Troubleshoot [errors](/docs/apm/apm-ui-pages/error-analytics/errors-page-find-fix-verify-problems/) with [distributed tracing](/docs/apm/distributed-tracing/ui-data/understand-use-distributed-tracing-data), stack traces, application logs, and more.
* Get deeper visibility into both your application and your platform performance data by forwarding your logs with our [infrastructure monitoring agent](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/forward-your-logs-using-infrastructure-agent/). Review your [infrastructure logs](/docs/logs/log-management/ui-data/use-logs-ui/#links) in the UI.
* Set up [alerts](/docs/alerts-applied-intelligence/new-relic-alerts/alert-policies/create-edit-or-find-alert-policy/).
* [Query your data](/docs/query-your-data/explore-query-data/get-started/introduction-querying-new-relic-data/) and [create dashboards](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards/).
