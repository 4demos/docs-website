---
title: Configure logs in context with APM agents
tags:
  - Logs
  - Enable log management in New Relic
  - Configure logs in context
metaDescription: Link your log data with related data across the rest of the New Relic platform by configuring logs in context with APM extensions.
redirects:
  - /docs/enable-logs-context-logs
  - /docs/enable-apm-logs-context-logs
  - /docs/logs/new-relic-logs/enable-logs-context/enable-apm-logs-context-logs
  - /docs/logs/new-relic-logs/enable-logs-context/enable-logs-context-apm-agents
  - /node/36951
  - /docs/logs/enable-logs/configure-logs-context/configure-logs-context-apm-agents
  - /docs/logs/enable-log-monitoring-new-relic/configure-logs-context/configure-logs-context-apm-agents
  - /docs/logs/new-relic-logs/enable-logs-context
  - /docs/logs/new-relic-logs/apm-integration
  - /docs/logs/log-monitoring/apm-integration
  - /docs/logs/log-management/apm-integration
  - /docs/logs/new-relic-logs/enable-logs/2-configure-logs-context-apm-agents
  - /docs/logs/log-monitoring/enable-logs/configure-logs-context-apm-agents
---

When you need to correlate log data with other telemetry data, enable logs in context in New Relic. Logs in context adds metadata that links your log data with related data, like [error](/docs/apm/apm-ui-pages/error-analytics/errors-page-find-fix-verify-problems/) or [distributed trace](/docs/apm/distributed-tracing/ui-data/understand-use-distributed-tracing-data) information in New Relic APM.

## See the root cause of issues across your platform [#compatibility-requirements]

By bringing all of your application and infrastructure data together in a single solution, you can more quickly get to the root cause of issues. Logs in context help you quickly see meaningful patterns and trends.

Don't spend extra time trying to narrow down all your logs from different parts of your platform. Instead, enable logs in context to see the exact log lines you need to identify and resolve a problem.

## Basic process to enable logs in context [#enable-logs]

The process to enable logs in context is basically the same, regardless of which APM agent you use to monitor your application:

1. Update to a supported APM agent version for your app, and enable [distributed tracing](/docs/understand-dependencies/distributed-tracing/enable-configure/enable-distributed-tracing/).
2. Configure logs in context for your APM agent, as explained in this document, or for your [infrastructure monitoring agent](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/forward-your-logs-using-infrastructure-agent/).
3. Configure a [supported log forwarder](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/enable-log-management-new-relic/) to collect your application logs, as explained in the documentation for logs in context setup.
4. View your logs within the context of your apps or infrastructure in [New Relic One](/docs/logs/log-management/ui-data/use-logs-ui/#links).

The main differences in this procedure are which log forwarders are available for your agent, and how to configure the specific log forwarder.

## C SDK [#enable-c-sdk]

Logs in context is not available for APM apps monitored by the C SDK. Instead, you can build your own logging extension library by using the [Log API](/docs/logs/log-management/log-api/introduction-log-api/).

## Go [#enable-go]

To enable logs in context for APM apps monitored by Go:

1. Make sure your Go agent supports logs in context (agent version 2.12 or higher) and has [distributed tracing enabled](/docs/understand-dependencies/distributed-tracing/enable-configure/language-agents-enable-distributed-tracing/#go-version).
2. Install the [Logrus logging framework version 1.4.0 or higher](https://github.com/sirupsen/logrus) to forward logs to New Relic.
3. Configure logs in context for Go using the Logrus extension.

<CollapserGroup>
  <Collapser
    id="go-configure"
    title="Go configuration with Logrus"
  >

1. Import the following packages in files where Logrus is configured:

   ```
   import (
       log "github.com/sirupsen/logrus"
       "github.com/newrelic/go-agent/v3/integrations/logcontext/nrlogrusplugin"
       "github.com/newrelic/go-agent/v3/newrelic"
   )
   ```
2. Set the Logrus formatter to `nrlogrusplugin.ContextFormatter`:

   ```
   logger := log.New()
   logger.SetFormatter(nrlogrusplugin.ContextFormatter{})
   ```

   OR

   If you are using the Logrus standard logger:

   ```
   log.SetFormatter(nrlogrusplugin.ContextFormatter{})
   ```

   The logger will now look for a `newrelic.Transaction` inside its context and decorate logs accordingly.
3. Update your standard logging call to include contextual logging, and pass this to the logger.

   For example, instead of `logger.Info("Hello New Relic!")`, use

   ```
   ctx := newrelic.NewContext(context.Background(), txn)
   logger.WithContext(ctx).Info("Hello New Relic!")
   ```

   where `txn` is the current running transaction.

  </Collapser>

</CollapserGroup>

4. To verify that you have configured the log forwarder extension correctly, run your application and verify that the logging you have configured contains the following:

   * Includes `trace.id` and `span.id` fields
   * Has properly-formatted JSON lines

If everything is configured correctly and your data is being reported, you should see data in the [New Relic Logs UI](/docs/logs/log-management/ui-data/use-logs-ui/) using the query operator `has:span.id has:trace.id`.

## Java [#enable-java]

To enable logs in context for APM apps monitored by Java:

1. Make sure your Java agent supports logs in context (Java version 5.6.0 or higher) and [distributed tracing](/docs/understand-dependencies/distributed-tracing/enable-configure/language-agents-enable-distributed-tracing/#java).
2. Install the any of the following to forward logs to New Relic:
    * Dropwizard 1.3 or higher
    * Log4j 1.x
    * Log4j 2.x
    * Logback 1.2.0 or higher
    * java.util.logging with classpath additions if necessary
   
   If you use Spring or Spring Boot and aren't sure which extension you need, see our [Spring documentation](/docs/logs/enable-log-management-new-relic/logs-context-java/java-configure-spring-spring-boot/).  
3. Configure logs in context for Java with your selected log forwarder.

<CollapserGroup>
  <Collapser
    id="java-dropwizard"
    title="Dropwizard"
  >
  You can use [Dropwizard](https://dropwizard.readthedocs.io/en/release-1.3.x/manual/core.html#logging) with your Java app to forward your log data with related data across the rest of the New Relic platform. The [code](https://github.com/newrelic/java-log-extensions/tree/main/dropwizard) and an [example application](https://github.com/newrelic/java-log-extensions/tree/main/examples/dropwizard-app) are available on GitHub.

1. Enable the JVM argument [JVM argument `-javaagent`](/docs/agents/java-agent/installation/include-java-agent-jvm-argument) on the Java agent.
2. Install the [Dropwizard 1.3 or higher](https://dropwizard.readthedocs.io/en/release-1.3.x/manual/core.html#logging) package on your application with the original Dropwizard appenders and logging factory.
3. Update your project's dependencies to include the Dropwizard 1.3 extension as applicable:

   * To update with Gradle, add the following to your `build.gradle` file:

     ```
     dependencies {
         compile("com.newrelic.logging:dropwizard:2.0")
     }
     ```
   * To update with Maven, add the following to your `pom.xml` file:

     ```
     <dependencies>
         <dependency>
             <groupId>com.newrelic.logging</groupId>
             <artifactId>dropwizard</artifactId>
             <version>2.0</version>
         </dependency>
     </dependencies>
     ```
4. Update your Dropwizard `.yaml` configuration file with a `newrelic-json` layout, replacing the currently used `type: console` or `type: file` with either `type: newrelic-console` or `type: newrelic-file` as appropriate. For example:

   ```
   logging:
     appenders:
       - <var>type: newrelic-console</var>
         # Add the two lines below if you don't have a layout specified on the appender.
         # If you have a layout, remove all parameters to the layout and set the type.
         layout: 
           <var>type: newrelic-json</var>
   ```

   Alternatively, the New Relic Dropwizard extension also supports a `log-format` layout type that uses the standard Dropwizard logging. For testing purposes, you can change the type of the layout with a one-line change:

   ```
   logging:
     appenders:
       - type: newrelic-file
         # This format will be ignored by the newrelic-json layout, but used by the log-format layout.
         logFormat: "%date{ISO8601} %c %-5p: %m trace.id=%mdc{trace.id} span.id=%mdc{span.id}%n"
         layout: 
           # type: newrelic-json
           type: log-format
   ```

  </Collapser>

  <Collapser
    id="java-util-logging"
    title="java.util.logging"
  >

To configure logs in context with the [`java.util.logging` package](https://docs.oracle.com/javase/7/docs/api/java/util/logging/package-summary.html):

1. Update your project's dependencies to include the `java.util.logging` extension as applicable:

   * Gradle: Add the following to your `build.gradle` file:

     ```
     dependencies {
         compile("com.newrelic.logging:jul:2.0")
     }
     ```
   * Maven: Add the following to your `pom.xml` file:

     ```
     <dependencies>
         <dependency>
             <groupId>com.newrelic.logging</groupId>
             <artifactId>jul</artifactId>
             <version>2.0</version>
         </dependency>
     </dependencies>
     ```

     If you can't edit these files, you can instead [add the jars directly to the application classpath](/docs/logs/enable-new-relic-logs/logs-context-java/java-adding-classpath/).
     
2. Check if your logging file's `handlers` property is set to something other than `NewRelicMemoryHandler`. Look for a line listing the root logger's handlers, like this:

   ```
   handlers = java.util.logging.FileHandler
   ```
3. Update your logging properties file to set the root logger's handler to `NewRelicMemoryHandler` so it intercepts messages destined for another handler:

   ```
   handlers = com.newrelic.logging.jul.NewRelicMemoryHandler
   ```
4. Configure the `NewRelicMemoryHandler` by setting the target to the handler that was previously assigned to the root logger, so it captures data New Relic needs on the thread the log message is coming from:

   ```
   com.newrelic.logging.jul.NewRelicMemoryHandler.target = java.util.logging.FileHandler
   ```

5. Use a `NewRelicFormatter` for the final handler. Update your logging properties file to set the `formatter` property like the following example. Make sure the handler where you set the formatter is the `target` handler from the previous step (`java.util.logging.FileHandler` in this example).

   ```
   java.util.logging.FileHandler.formatter = com.newrelic.logging.jul.NewRelicFormatter
   ```

     The New Relic log format is a tailored JSON format with specific fields in specific places that our log forwarder plugins and back end rely on. At this time, we don't support any customization of that format.

     Once complete, JSON is logged instead of text. The JSON should be formatted as single objects, one per line, and should contain fields like `log.level` and `thread.name`. The `trace.id`, which is required for logs in context, should only have a value for log messages that occur within a transaction.

  </Collapser>

  <Collapser
    id="java-util-logging"
    title="java.util.logging classpath additions"
  >

  The most direct way to get the logs in context extensions with the [`java.util.logging` package](https://docs.oracle.com/javase/7/docs/api/java/util/logging/package-summary.html) is to add the dependencies to Maven's `pom.xml` or Gradle's `build.gradle`. This allows the packaging tools pick up the correct dependencies. If you are unable to modify the application and repackage it, you can still set up logs in context by making some additions to your `classpath`.

  Before you modify the classpath:

    * Make sure the [JVM argument `-javaagent`](/docs/agents/java-agent/installation/include-java-agent-jvm-argument/) is enabled on your app's Java agent.
    * You must know the logging framework the application is using.
    * You must be able to change your logging framework's configuration.

Add the following three jars to the classpath if they aren't already present. Generally, we recommend taking the latest versions published on Maven Central.

* Group ID `com.newrelic.logging` and Artifact ID: Select the artifact named after [your application's logging framework in Maven](https://search.maven.org/search?q=g:com.newrelic.logging).
* Group ID `com.fasterxml.jackson.core` and Artifact ID: Use [`jackson-core`](https://search.maven.org/search?q=g:com.fasterxml.jackson.core%20a:jackson-core).
* Group ID `com.newrelic.agent.java` and Artifact ID: Use [`newrelic-api`](https://search.maven.org/search?q=g:com.newrelic.agent.java%20a:newrelic-api).

  </Collapser>

  <Collapser
    id="java-log4j-1x"
    title="Log4j 1.x"
  >

  text

  </Collapser>

  <Collapser
    id="java-log4j-2x"
    title="jLog4j 2.x"
  >

  text

  </Collapser>

  <Collapser
    id="java-logback"
    title="Logback"
  >

  text

  </Collapser>

  <Collapser
    id="java-spring"
    title="Spring and Springboot"
  >

  text

  </Collapser>

  </CollapserGroup>

  4. To verify that you have configured the log forwarder extension correctly, run your application and verify that the logging you have configured contains the following:

     * Includes `trace.id` and `span.id` fields
     * Has properly-formatted JSON lines

If everything is configured correctly and your data is being reported, you should see data in the [New Relic Logs UI](/docs/logs/log-management/ui-data/use-logs-ui/) using the query operator `has:span.id has:trace.id`.

## Agent API [#enable-api]

If you use a logging framework not covered by our existing logs-in-context solutions, you can use your APM agent API. This solution passes the linking metadata required to automatically correlate logs with errors and traces.

You can also build your own logging extension library for any language/logging framework by using the APM agent API or the [Log API](/docs/logs/log-management/log-api/introduction-log-api/).



## What's next? [#what-next]

After you set up APM logs in context, make the most of your logging data:

* Explore the logging data across your platform with our [Logs UI](/docs/logs/log-management/ui-data/use-logs-ui/).
* See your logs in context of your app's performance in the [APM UI](/docs/logs/log-management/ui-data/use-logs-ui/#links). Troubleshoot [errors](/docs/apm/apm-ui-pages/error-analytics/errors-page-find-fix-verify-problems/) with [distributed tracing](/docs/apm/distributed-tracing/ui-data/understand-use-distributed-tracing-data), stack traces, application logs, and more.
* Get deeper visibility into both your application and your platform performance data by forwarding your logs with our [infrastructure monitoring agent](/docs/logs/enable-log-management-new-relic/enable-log-monitoring-new-relic/forward-your-logs-using-infrastructure-agent/). Review your [infrastructure logs](/docs/logs/log-management/ui-data/use-logs-ui/#links) in the UI.
* Set up [alerts](/docs/alerts-applied-intelligence/new-relic-alerts/alert-policies/create-edit-or-find-alert-policy/).
* [Query your data](/docs/query-your-data/explore-query-data/get-started/introduction-querying-new-relic-data/) and [create dashboards](/docs/query-your-data/explore-query-data/dashboards/introduction-dashboards/).
