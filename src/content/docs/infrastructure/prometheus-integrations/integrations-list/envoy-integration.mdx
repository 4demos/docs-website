---
title: 'Envoy integration'
tags:
  - Integrations
  - Envoy
  - Prometheus
  - Kubernetes
---

import kubernetesEnvoyDashboard from 'images/kubernetes_screenshot-crop_envoy-dashboard.png'

[Envoy](https://www.envoyproxy.io/) is a high-performance C++ distributed proxy designed for single services and applications. Envoy is also a communication bus and “universal data plane” designed for large microservice “service mesh” architectures. 

<img
  title="Envoy Dashboard"
  alt="Envoy Dashboard"
  src={kubernetesEnvoyDashboard}
/>

## Enable the integration

Follow these steps to enable the integration.

### Step 1: Follow Envoy documentation

Follow the [Envoy documentation](https://www.envoyproxy.io/docs/envoy/latest/start/install) to install pre-built Docker images and then check out the [quick start guide](https://www.envoyproxy.io/docs/envoy/latest/start/quick-start/index.html#start-quick-start) to get your Envoy proxy up and running.

### Step 2: Set up Prometheus monitoring

Prometheus metrics needs to be integrated with New Relic, you can use the Prometheus Agent or the Remote Write integration, see [how to send Prometheus metrics](https://docs.newrelic.com/docs/infrastructure/prometheus-integrations/get-started/send-prometheus-metric-data-new-relic/).

Change the `remote_write`, the `scrape_configs`, and `write_relabel_configs` sections of the YAML file as follows.

```
scrape_configs:
  job_name: "EnvoyProxy"
  metrics_path: '/stats'
  params:
    format: ['prometheus']
  static_configs:
    targets: ["ENVOY_MONITOR_IP:9901"]

remote_write:
  url: https://metric-api.newrelic.com/prometheus/v1/write?prometheus_server=<EnvoyProxy_Prometheus>
  bearer_token: <REMOTE_WRITE_API_KEY>
  
write_relabel_configs:
  source_labels: [job]
  regex: 'EnvoyProxy'
  action: keep
``` 

### Step 3: Checking

Once integrated, use the following query to confirm metrics are being ingested as expected:

```
  FROM Metric SELECT count(*) WHERE metricName LIKE 'envoy_%' FACET metricName LIMIT MAX
```

### Step 4: Install the quickstart and see alerts

Install the [Envoy quickstart](https://newrelic.com/instant-observability/Envoy-quickstart) to access built-in dashboards and [alerts](https://docs.newrelic.com/docs/alerts-applied-intelligence/new-relic-alerts/learn-alerts/introduction-alerts/).

## Find and use the data

### Metrics

Prometheus metrics are stored as dimensional metrics. You can [query using NRQL](/docs/telemetry-data-platform/get-data/apis/query-metric-data-type/) or use the [Data Explorer](/docs/query-your-data/explore-query-data/browse-data/introduction-data-explorer/) to browse the available metrics, facet, and filter by the associated dimensions.

The different sets of metrics exposed by this integration are defined in the [Envoy documentation](https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/observability/statistics.html?highlight=statistics/).

Use the following NRQL queries to understand the metrics being ingested in New Relic:

* List unique metric names:

  ```
  FROM Metric SELECT uniques(metricName) WHERE metricName LIKE 'envoy_%' LIMIT MAX
  ```

* Count number of metric updates:

  ```
  FROM Metric SELECT datapointcount() WHERE metricName LIKE 'envoy_%' FACET metricName
  ```

* Estimate data ingestion (daily ingest, in bytes):

	```
  FROM Metric SELECT bytecountestimate() WHERE metricName LIKE 'envoy_%' SINCE 1 day ago
  ```

### Entities

This integration enables `Envoy` entities powering the full set of [entity capabilities](/docs/new-relic-solutions/new-relic-one/core-concepts/what-entity-new-relic/) such as golden metrics, entity dashboards, workloads, and lookout.

## Troubleshooting

Follow the troubleshooting tips from [Envoy documentation](https://www.envoyproxy.io/docs/envoy/latest/operations/admin#get--stats?format=prometheus/) to make sure that metrics are configured as expected on your cluster.

You can also check the specific [troubleshooting guidelines](/docs/infrastructure/prometheus-integrations/troubleshooting/no-data-appears-prometheus-integration) for Prometheus integrations.