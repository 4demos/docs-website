---
title: 'CockroachDB integration'
tags:
  - Integrations
  - CockroachDB
  - Prometheus
  - Kubernetes
---


[Cockroach Database](https://www.cockroachlabs.com/docs/) is a distributed SQL database built on a transactional and strongly-consistent key-value store.

Cockroach Database has these characteristics:

* Scales horizontally
* Survives disk, machine, rack, and even datacenter failures with minimal latency disruption and no manual intervention
* Supports strongly-consistent ACID transactions
* Provides a familiar SQL API for structuring, manipulating, and querying data

CockroachDB generates detailed time series metrics for each node in a cluster. [Monitor CockroachDB with Prometheus](https://www.cockroachlabs.com/docs/v22.1/monitor-cockroachdb-with-prometheus.html#before-you-begin) shows you how to pull these metrics into Prometheus.

Use New Relic to monitor:
* Cluster health
* Node health
* Store and disk capacity
* SQL queries performance
* High open file descriptor count
* Certificate expirations

<img width="1919" alt="image" src="https://user-images.githubusercontent.com/82898004/203817132-b3814cb1-733a-4b98-8b43-cf9331db500d.png">


## Enable the integration

Follow these steps to enable the integration.

1. Follow the  [CockroachDB documentation](https://www.cockroachlabs.com/docs/v22.1/monitor-cockroachdb-with-prometheus.html) for Prometheus to discover the CockroachDB metrics endpoints.

2. Set up Prometheus monitoring. Prometheus metrics needs to be integrated with New Relic, you can use the Prometheus Agent or the Remote Write integration, see [how to send Prometheus metrics](/docs/infrastructure/prometheus-integrations/install-configure-prometheus-agent/get-started/send-prometheus-metric-data-new-relic/).

<Callout variant="Prometheus Agent ONLY!">
Prometheus Agent [by default](/docs/infrastructure/prometheus-integrations/install-configure-prometheus-agent/setup-prometheus-agent#scrape-metrics-only-from-prometheus-integrations-scrape-prometheus-integrations) only scrapes metrics from a [set of integrations](/docs/infrastructure/prometheus-integrations/integrations-list/integrations-list-intro).
  
If this is the case make sure your pod or endpoint can be identifed with one of the following labels "app.kubernetes.io/name", "app.newrelic.io/name", "k8s-app" containing the string "cockroachdb"
</Callout>

3. Use the following query to confirm metrics are being ingested as expected:

  ```sql
    FROM Metric SELECT count(*) WHERE job='cockroachdb' FACET metricName LIMIT MAX
  ```

4. Install the [CockroachDB quickstart](https://newrelic.com/instant-observability/?search=cockroachdb) to access built-in dashboards and [alerts](/docs/alerts-applied-intelligence/new-relic-alerts/learn-alerts/introduction-alerts/).

<Callout variant="Important!">
  
  Some charts of the dashboard include queries with conditions that requires yourpod or endpoint to be identifed with one of the following labels "app.kubernetes.io/name", "app.newrelic.io/name", "k8s-app" containing the string "cockroachdb"

</Callout>

  Once you imported, you can edit or clone the assets to adapt them to your specific requirements.

## Find and use the data

### Metrics

Prometheus metrics are stored as dimensional metrics. You can [query using NRQL](/docs/telemetry-data-platform/get-data/apis/query-metric-data-type/) or use the [Data Explorer](/docs/query-your-data/explore-query-data/browse-data/introduction-data-explorer/) to browse the available metrics, facet, and filter by the associated dimensions.

The different sets of metrics exposed by this integration are defined in the [CockroachDB documentation](https://www.cockroachlabs.com/docs/stable/monitoring-and-alerting.html).

Use the following NRQL queries to understand the CockroachDB metrics being ingested in New Relic.

<Callout variant="tip">
Adjust the job name as per your configuration settings.
</Callout>

* List unique metric names:

  ```sql
  FROM Metric SELECT uniques(metricName) WHERE job='cockroachdb' LIMIT MAX
  ```

* Count number of metric updates:

  ```sql
  FROM Metric SELECT datapointcount() WHERE WHERE job='cockroachdb' FACET metricName
  ```

* Estimate data ingestion (daily ingest, in bytes):

	```sql
  FROM Metric SELECT bytecountestimate() WHERE job='cockroachdb' SINCE 1 day ago
  ```

## Troubleshooting

Follow the troubleshooting tips from [CockroachDB documentation](https://www.cockroachlabs.com/docs/v22.1/monitor-cockroachdb-with-prometheus.html) to make sure that metrics are configured as expected on your cluster.

You can also check the specific [troubleshooting guidelines](/docs/infrastructure/prometheus-integrations/troubleshooting/no-data-appears-prometheus-integration) for Prometheus integrations.


