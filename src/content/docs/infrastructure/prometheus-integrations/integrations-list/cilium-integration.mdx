---
title: 'Cilium integration'
tags:
  - Integrations
  - Cilium
  - Prometheus
  - Kubernetes
---

import kubernetesCiliumDashboard from 'images/kubernetes_screenshot-crop_cilium-dashboard.png'

[Cilium](https://cilium.io/get-started/) is an open-source project to provide networking, security, and observability for cloud-native environments such as Kubernetes clusters and other container orchestration platforms. It is cloud-native and fueled by the revolutionary Kernel technology eBPF.

Cilium can monitor:
* Cilium node details
* Cilium pod events
* API call latency/IPV4 TCP
* Open file descriptors
* Forwarded packets versus dropped packets

<img
  title="Cilium Dashboard"
  alt="Cilium Dashboard"
  src={kubernetesCiliumDashboard}
/>

## Enable the integration

Follow these steps to enable the integration.

### Step 1: Follow Cilium documentation

Follow the [Cilium documentation](https://docs.cilium.io/en/stable/operations/metrics/) to add the required configuration along with an example deployment for Prometheus to discover the metrics endpoints.

Cilium installation uses this helm command and deploys Cilium with operator and hubble metrics enabled.

```
  helm install cilium cilium/cilium --version 1.12.2 \
  --namespace kube-system \
  --set prometheus.enabled=true \
  --set operator.prometheus.enabled=true \
  --set hubble.enabled=true \
  --set hubble.metrics.enabled="{dns,drop,tcp,flow,icmp,http,flows-to-world,port-distribution}"
```

### Step 2: Set up Prometheus monitoring

Prometheus metrics needs to be integrated with New Relic, you can use the Prometheus Agent or the Remote Write integration, see [how to send Prometheus metrics](https://docs.newrelic.com/docs/infrastructure/prometheus-integrations/get-started/send-prometheus-metric-data-new-relic/).

Change the `remote_write` section of the YAML config file.

```
remote_write:
- url: https://xxxx.newrelic.com/prometheus/v1/write?prometheus_server=Cilium-prometheus
      bearer_token: xxxxxxxxx
```

### Step 3: Checking

Once integrated, use the following query to confirm metrics are being ingested as expected:

* Cilium

```
  FROM Metric SELECT count(*) WHERE metricName LIKE 'cilium_%' FACET metricName LIMIT MAX SINCE 30 minutes ago
```

* Hubble

```
  FROM Metric SELECT count(*) WHERE metricName LIKE 'hubble_%' FACET metricName LIMIT MAX SINCE 30 minutes ago
```

Cilium entities are also visible in [New Relic Explorer](/docs/new-relic-solutions/new-relic-one/core-concepts/new-relic-explorer-view-performance-across-apps-services-hosts/) with associated golden metrics and a built-in entity dashboard. 

### Step 4: Install the quickstart and see alerts

Install the [Cilium quickstart](https://newrelic.com/instant-observability/ext-cilium-quickstart) to access built-in dashboards and [alerts](https://docs.newrelic.com/docs/alerts-applied-intelligence/new-relic-alerts/learn-alerts/introduction-alerts/).

Once you import the dashboard, you can adapt assets (edit or clon) based on your specific requirements.

## Find and use the data

### Metrics

Prometheus metrics are stored as dimensional metrics. You can [query using NRQL](/docs/telemetry-data-platform/get-data/apis/query-metric-data-type/) or use the [Data Explorer](/docs/query-your-data/explore-query-data/browse-data/introduction-data-explorer/) to browse the available metrics, facet, and filter by the associated dimensions.

The different sets of metrics exposed by this integration are defined in the [Cilium documentation](https://docs.cilium.io/en/stable/operations/metrics/).

Use the following NRQL queries to understand the cilium metrics being ingested in New Relic:

* List unique metric names:

  ```
  FROM Metric SELECT uniques(metricName) WHERE metricName LIKE 'cilium_%'  LIMIT MAX SINCE 1 day ago
  ```

* Count number of metric updates:

  ```
  FROM Metric SELECT datapointcount() WHERE metricName LIKE 'cilium_%' FACET metricName SINCE 1 day ago
  ```

* Estimate data ingestion (daily ingest, in bytes):

	```
  FROM Metric SELECT bytecountestimate() WHERE metricName LIKE 'cilium_%' SINCE 1 day ago
  ```

Use the following NRQL queries to understand the hubble metrics being ingested in New Relic:

* List unique metric names:

  ```
  FROM Metric SELECT uniques(metricName) WHERE metricName LIKE 'hubble_%'  LIMIT MAX SINCE 1 day ago
  ```

* Count number of metric updates:

  ```
  FROM Metric SELECT datapointcount() WHERE metricName LIKE ' hubble_%' FACET metricName SINCE 1 day ago
  ```

* Estimate data ingestion (daily ingest, in bytes):

	```
  FROM Metric SELECT bytecountestimate() WHERE metricName LIKE 'hubble_%' SINCE 1 day ago
  ```

### Entities

This integration enables `Cilium` entities powering the full set of [entity capabilities](/docs/new-relic-solutions/new-relic-one/core-concepts/what-entity-new-relic/) such as golden metrics, entity dashboards, workloads, and lookout.

## Troubleshooting

Follow the troubleshooting tips from [Cilium documentation](https://docs.cilium.io/en/stable/operations/troubleshooting/#admin-guide) to make sure that metrics are configured as expected on your cluster.

You can also check the specific [troubleshooting guidelines](/docs/infrastructure/prometheus-integrations/troubleshooting/no-data-appears-prometheus-integration) for Prometheus integrations.